{"content":"<div><div class=\"content\">\n<p>Ordinarily, when you perform date and time arithmetic using <a class=\"xref\" href=\"../../../api/system.datetimeoffset\" data-linktype=\"relative-path\">System.DateTimeOffset</a> values, the result does not reflect any time zone adjustment rules. This is true even when the time zone of the date and time value is clearly identifiable. This article shows how to perform arithmetic operations on date and time values that belong to a particular time zone. The results of the arithmetic operations will reflect the time zone&#39;s adjustment rules.</p>\n<h2 id=\"to-apply-adjustment-rules-to-date-and-time-arithmetic\">To apply adjustment rules to date and time arithmetic</h2>\n<ol>\n<li><p>Implement some method of closely coupling a date and time value with the time zone to which it belongs. For example, declare a structure that includes both the date and time value and its time zone. The following example uses this approach to link a <a class=\"xref\" href=\"../../../api/system.datetimeoffset\" data-linktype=\"relative-path\">DateTimeOffset</a> value with its time zone.</p>\n<pre class=\"loading\"><code class=\"lang-csharp\"> // Define a structure for DateTime values for internal use only\n internal struct TimeWithTimeZone\n {\n TimeZoneInfo TimeZone;\n DateTimeOffset Time;\n }\n</code></pre><pre class=\"loading\"><code class=\"lang-vb\"> &#39; Define a structure for DateTime values for internal use only\n Friend Structure TimeWithTimeZone\n    Dim TimeZone As TimeZoneInfo\n    Dim Time As Date\n End Structure\n</code></pre></li>\n<li><p>Convert a time to Coordinated Universal Time (UTC) by calling the <a class=\"xref\" href=\"../../../api/system.timezoneinfo#System_TimeZoneInfo_ConvertTime_System_DateTime_System_TimeZoneInfo_\" data-linktype=\"relative-path\">TimeZoneInfo.ConvertTime(DateTime, TimeZoneInfo)</a> method.</p>\n</li>\n<li><p>Perform the arithmetic operation on the UTC time.</p>\n</li>\n<li><p>Convert the time from UTC to the original time&#39;s associated time zone by calling the <a class=\"xref\" href=\"../../../api/system.timezoneinfo#System_TimeZoneInfo_ConvertTime_System_DateTime_System_TimeZoneInfo_\" data-linktype=\"relative-path\">TimeZoneInfo.ConvertTime(DateTime, TimeZoneInfo)</a> method. </p>\n</li>\n</ol>\n<h2 id=\"example\">Example</h2>\n<p>The following example adds two hours and thirty minutes to March 9, 2008, at 1:30 A.M. Central Standard Time. The time zone&#39;s transition to daylight saving time occurs thirty minutes later, at 2:00 A.M. on March 9, 2008. Because the example follows the four steps listed in the previous section, it correctly reports the resulting time as 5:00 A.M. on March 9, 2008. </p>\n<pre class=\"loading\"><code class=\"lang-csharp\">using System;\n\npublic struct TimeZoneTime\n{\n   public TimeZoneInfo TimeZone;\n   public DateTimeOffset Time;\n\n   public TimeZoneTime(TimeZoneInfo tz, DateTimeOffset time)\n   {\n      if (tz == null) \n         throw new ArgumentNullException(&quot;The time zone cannot be a null reference.&quot;);\n\n      this.TimeZone = tz;\n      this.Time = time;   \n   }\n\n   public TimeZoneTime AddTime(TimeSpan interval)\n   {\n      // Convert time to UTC\n      DateTimeOffset utcTime = TimeZoneInfo.ConvertTime(this.Time, TimeZoneInfo.Utc);      \n      // Add time interval to time\n      utcTime = utcTime.Add(interval);\n      // Convert time back to time in time zone\n      return new TimeZoneTime(this.TimeZone, TimeZoneInfo.ConvertTime(utcTime, this.TimeZone));\n   }\n}\n\npublic class TimeArithmetic\n{\n   public const string tzName = &quot;Central Standard Time&quot;;\n\n   public static void Main()\n   {\n      try\n      {\n         TimeZoneTime cstTime1, cstTime2;\n\n         TimeZoneInfo cst = TimeZoneInfo.FindSystemTimeZoneById(tzName);\n         DateTime time1 = new DateTime(2008, 3, 9, 1, 30, 0);          \n         TimeSpan twoAndAHalfHours = new TimeSpan(2, 30, 0);\n\n         cstTime1 = new TimeZoneTime(cst, \n                        new DateTimeOffset(time1, cst.GetUtcOffset(time1)));\n         cstTime2 = cstTime1.AddTime(twoAndAHalfHours);\n         Console.WriteLine(&quot;{0} + {1} hours = {2}&quot;, cstTime1.Time, \n                                                    twoAndAHalfHours.ToString(),  \n                                                    cstTime2.Time);\n      }\n      catch\n      {\n         Console.WriteLine(&quot;Unable to find {0}.&quot;, tzName);\n      }\n   }\n}\n</code></pre><pre class=\"loading\"><code class=\"lang-vb\">Public Structure TimeZoneTime\n   Public TimeZone As TimeZoneInfo\n   Public Time As Date\n\n   Public Sub New(tz As TimeZoneInfo, time As Date)\n      If tz Is Nothing Then _\n         Throw New ArgumentNullException(&quot;The time zone cannot be a null reference.&quot;)\n\n      Me.TimeZone = tz\n      Me.Time = time\n   End Sub\n\n   Public Function AddTime(interval As TimeSpan) As TimeZoneTime\n      &#39; Convert time to UTC\n      Dim utcTime As DateTime = TimeZoneInfo.ConvertTimeToUtc(Me.Time, _\n                                                              Me.TimeZone)      \n      &#39; Add time interval to time\n      utcTime = utcTime.Add(interval)\n      &#39; Convert time back to time in time zone\n      Return New TimeZoneTime(Me.TimeZone, TimeZoneInfo.ConvertTime(utcTime, _\n                              TimeZoneInfo.Utc, Me.TimeZone))\n   End Function\nEnd Structure\n\nModule TimeArithmetic\n   Public Const tzName As String = &quot;Central Standard Time&quot;\n\n   Public Sub Main()\n      Try\n         Dim cstTime1, cstTime2 As TimeZoneTime\n\n         Dim cst As TimeZoneInfo = TimeZoneInfo.FindSystemTimeZoneById(tzName)\n         Dim time1 As Date = #03/09/2008 1:30AM#\n         Dim twoAndAHalfHours As New TimeSpan(2, 30, 0)\n\n         cstTime1 = New TimeZoneTime(cst, time1)\n         cstTime2 = cstTime1.AddTime(twoAndAHalfHours)\n\n         Console.WriteLine(&quot;{0} + {1} hours = {2}&quot;, cstTime1.Time, _\n                                                    twoAndAHalfHours.ToString(), _ \n                                                    cstTime2.Time)  \n      Catch\n         Console.WriteLine(&quot;Unable to find {0}.&quot;, tzName)\n      End Try   \n   End Sub   \nEnd Module\n</code></pre><p>Note that if this addition is simply performed on the <a class=\"xref\" href=\"../../../api/system.datetimeoffset\" data-linktype=\"relative-path\">DateTimeOffset</a> value without first converting it to UTC, the result reflects the correct point in time but its offset does not reflect that of the designated time zone for that time. </p>\n<p><a class=\"xref\" href=\"../../../api/system.datetimeoffset\" data-linktype=\"relative-path\">DateTimeOffset</a> values are disassociated from any time zone to which they might belong. To perform date and time arithmetic in a way that automatically applies a time zone&#39;s adjustment rules, the time zone to which any date and time value belongs must be immediately identifiable. This means that a date and time and its associated time zone must be tightly coupled. There are several ways to do this, which include the following:</p>\n<ul>\n<li><p>Assume that all times used in an application belong to a particular time zone. Although appropriate in some cases, this approach offers limited flexibility and possibly limited portability.</p>\n</li>\n<li><p>Define a type that tightly couples a date and time with its associated time zone by including both as fields of the type. This approach is used in the code example, which defines a structure to store the date and time and the time zone in two member fields.</p>\n</li>\n</ul>\n<h2 id=\"see-also\">See Also</h2>\n<p><a href=\"index\" data-linktype=\"relative-path\">Dates, times, and time zones</a></p>\n<p><a href=\"performing-arithmetic-operations\" data-linktype=\"relative-path\">Performing arithmetic operations with dates and times</a></p>\n</div></div>","outputRootRelativePath":"../../../","pageMetadata":"<meta name=\"author\" content=\"stevehoag\">\r\n<meta name=\"ms.author\" content=\"shoag\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc1.json\">\r\n<meta name=\"apiPlatform\" content=\"dotnet\">\r\n<meta name=\"ms.devlang\" content=\"dotnet\">\r\n<meta name=\"ms.assetid\" content=\"26870cdc-1709-4978-831b-ff2a2f24856f\">\r\n<meta name=\"description\" content=\"How to use time zones in date and time arithmetic\">\r\n<meta name=\"keywords\" content=\".NET, .NET Core\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"ms.date\" content=\"08/16/2016\">\r\n<meta name=\"ms.technology\" content=\"dotnet-standard\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2016-12-15 06:00 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/standard/datetime/use-time-zones-in-arithmetic.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/standard/datetime/use-time-zones-in-arithmetic.md\">\r\n<meta name=\"document_id\" content=\"19f83ef3-29de-ffc0-ba72-9d628c34973f\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"../../toc1.json\">\r\n","rawMetadata":{"author":"stevehoag","ms.author":"shoag","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","apiPlatform":"dotnet","title":"How to: use time zones in date and time arithmetic | Microsoft Docs","ms.devlang":"dotnet","ms.assetid":"26870cdc-1709-4978-831b-ff2a2f24856f","description":"How to use time zones in date and time arithmetic","keywords":".NET, .NET Core","ms.topic":"article","ms.date":"08/16/2016","ms.technology":"dotnet-standard","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Steve Hoag","author_email":"shoag@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Porting date and time topics from MSDN (#992)","commit_sha":"c40c28da09e8a122b542463c197196c82c81dd19","commit_date":"2016-09-06 10:55:51 -0700"},{"author_name":"Maira Wenzel","author_email":"mairaw@users.noreply.github.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Revert \"Bringing back essentials topics\" (#661)","commit_sha":"6d10e1507a2a8040743da29184fa4981ddbf7af3","commit_date":"2016-06-26 17:59:39 -0700"},{"author_name":"Steve Hoag","author_email":"shoag@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Bringing back essentials topics (#659)","commit_sha":"5f3ebe05f34a44b449412c6334e47a9861b36c79","commit_date":"2016-06-26 17:27:32 -0700"}],"updated_at":"2016-12-15 06:00 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag","id":"13489215"},"contributors":[{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"12/15/2016"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/standard/datetime/use-time-zones-in-arithmetic.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/standard/datetime/use-time-zones-in-arithmetic.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/standard/datetime/use-time-zones-in-arithmetic.md","document_id":"19f83ef3-29de-ffc0-ba72-9d628c34973f","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet/articles/standard/datetime/use-time-zones-in-arithmetic","toc_asset_id":"articles/toc.json","toc_rel":"../../toc.json","_op_ogTitle":"How to: use time zones in date and time arithmetic","_op_displayDate":"2016-8-16","_op_displayDate_source":"2016-08-16T00:00:00Z","_op_wordCount":796,"_op_rawTitle":"<h1 id=\"how-to-use-time-zones-in-date-and-time-arithmetic\" sourcefile=\"docs/standard/datetime/use-time-zones-in-arithmetic.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\">How to: use time zones in date and time arithmetic</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/articles/standard/datetime/use-time-zones-in-arithmetic","fileRelativePath":"articles/standard/datetime/use-time-zones-in-arithmetic.html"},"themesRelativePathToOutputRoot":"_themes/"}