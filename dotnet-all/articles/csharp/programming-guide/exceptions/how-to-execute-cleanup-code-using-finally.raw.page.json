{"content":"<div><div class=\"content\">\n<p>The purpose of a <code>finally</code> statement is to ensure that the necessary cleanup of objects, usually objects that are holding external resources, occurs immediately, even if an exception is thrown. One example of such cleanup is calling <a class=\"xref\" href=\"../../../../api/system.io.stream#System_IO_Stream_Close_\" data-linktype=\"relative-path\">Close</a> on a <a class=\"xref\" href=\"../../../../api/system.io.filestream\" data-linktype=\"relative-path\">FileStream</a> immediately after use instead of waiting for the object to be garbage collected by the common language runtime, as follows:  </p>\n<pre><code class=\"lang-cs\" name=\"csProgGuideExceptions#16\">        static void CodeWithoutCleanup()\n        {\n            System.IO.FileStream file = null;\n            System.IO.FileInfo fileInfo = new System.IO.FileInfo(&quot;C:\\\\file.txt&quot;);\n\n            file = fileInfo.OpenWrite();\n            file.WriteByte(0xF);\n\n            file.Close();\n        }\n</code></pre><h2 id=\"example\">Example</h2>\n<p> To turn the previous code into a <code>try-catch-finally</code> statement, the cleanup code is separated from the working code, as follows.  </p>\n<pre><code class=\"lang-cs\" name=\"csProgGuideExceptions#17\">        static void CodeWithCleanup()\n        {\n            System.IO.FileStream file = null;\n            System.IO.FileInfo fileInfo = null;\n\n            try\n            {\n                fileInfo = new System.IO.FileInfo(&quot;C:\\\\file.txt&quot;);\n\n                file = fileInfo.OpenWrite();\n                file.WriteByte(0xF);\n            }\n            catch(System.UnauthorizedAccessException e)\n            {\n                System.Console.WriteLine(e.Message);\n            }\n            finally\n            {\n                if (file != null)\n                {\n                    file.Close();\n                }\n            }\n        }\n</code></pre><p> Because an exception can occur at any time within the <code>try</code> block before the <code>OpenWrite()</code> call, or the <code>OpenWrite()</code> call itself could fail, we are not guaranteed that the file is open when we try to close it. The <code>finally</code> block adds a check to make sure that the <a class=\"xref\" href=\"../../../../api/system.io.filestream\" data-linktype=\"relative-path\">FileStream</a> object is not <code>null</code> before you call the <a class=\"xref\" href=\"../../../../api/system.io.stream#System_IO_Stream_Close_\" data-linktype=\"relative-path\">Close</a> method. Without the <code>null</code> check, the <code>finally</code> block could throw its own <a class=\"xref\" href=\"../../../../api/system.nullreferenceexception\" data-linktype=\"relative-path\">NullReferenceException</a>, but throwing exceptions in <code>finally</code> blocks should be avoided if it is possible.  </p>\n<p> A database connection is another good candidate for being closed in a <code>finally</code> block. Because the number of connections allowed to a database server is sometimes limited, you should close database connections as quickly as possible. If an exception is thrown before you can close your connection, this is another case where using the <code>finally</code> block is better than waiting for garbage collection.  </p>\n<h2 id=\"see-also\">See Also</h2>\n<p> <a href=\"../index\" data-linktype=\"relative-path\">C# Programming Guide</a><br> <a href=\"index\" data-linktype=\"relative-path\">Exceptions and Exception Handling</a><br> <a href=\"exception-handling\" data-linktype=\"relative-path\">Exception Handling</a><br> <a href=\"../../language-reference/keywords/using-statement\" data-linktype=\"relative-path\">using Statement</a><br> <a href=\"../../language-reference/keywords/try-catch\" data-linktype=\"relative-path\">try-catch</a><br> <a href=\"../../language-reference/keywords/try-finally\" data-linktype=\"relative-path\">try-finally</a><br> <a href=\"../../language-reference/keywords/try-catch-finally\" data-linktype=\"relative-path\">try-catch-finally</a></p>\n</div></div>","outputRootRelativePath":"../../../../","pageMetadata":"<meta name=\"author\" content=\"BillWagner\">\r\n<meta name=\"ms.author\" content=\"wiwagn\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"/dotnet-all/api/toc2.json\">\r\n<meta name=\"ms.assetid\" content=\"1b1e5aef-3f32-4a88-9d39-b5fffb33bdaf\">\r\n<meta name=\"translation.priority.ht\" content=\"cs-cz\">\r\n<meta name=\"translation.priority.ht\" content=\"de-de\">\r\n<meta name=\"translation.priority.ht\" content=\"es-es\">\r\n<meta name=\"translation.priority.ht\" content=\"fr-fr\">\r\n<meta name=\"translation.priority.ht\" content=\"it-it\">\r\n<meta name=\"translation.priority.ht\" content=\"ja-jp\">\r\n<meta name=\"translation.priority.ht\" content=\"ko-kr\">\r\n<meta name=\"translation.priority.ht\" content=\"pl-pl\">\r\n<meta name=\"translation.priority.ht\" content=\"pt-br\">\r\n<meta name=\"translation.priority.ht\" content=\"ru-ru\">\r\n<meta name=\"translation.priority.ht\" content=\"tr-tr\">\r\n<meta name=\"translation.priority.ht\" content=\"zh-cn\">\r\n<meta name=\"translation.priority.ht\" content=\"zh-tw\">\r\n<meta name=\"caps.latest.revision\" content=\"21\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"ms.date\" content=\"2015-07-20\">\r\n<meta name=\"ms.technology\" content=\"devlang-csharp\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2017-03-15 06:14 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/3115359729431ecbcc16058612da59b85621fa0f/docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md\">\r\n<meta name=\"document_id\" content=\"b57be206-ceec-85da-edab-b759162a16e9\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"toc2.json\">\r\n","rawMetadata":{"author":"BillWagner","ms.author":"wiwagn","manager":"wpickett","breadcrumb_path":"/dotnet-internal/toc.json","title":"How to: Execute Cleanup Code Using finally (C# Programming Guide) | Microsoft Docs","ms.assetid":"1b1e5aef-3f32-4a88-9d39-b5fffb33bdaf","translation.priority.ht":["cs-cz","de-de","es-es","fr-fr","it-it","ja-jp","ko-kr","pl-pl","pt-br","ru-ru","tr-tr","zh-cn","zh-tw"],"caps.latest.revision":21,"ms.topic":"article","dev_langs":["csharp"],"helpviewer_keywords":["try/finally blocks [C#]","exceptions [C#], try/finally block","exception handling [C#], try/finally block"],"ms.date":"2015-07-20","ms.technology":["devlang-csharp"],"ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Bill Wagner","author_email":"wiwagn@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Reorganize the C# Guide TOC (#1318)","commit_sha":"3115359729431ecbcc16058612da59b85621fa0f","commit_date":"2017-01-23 23:20:14 -0500"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"Bill Wagner","comitter_email":"wiwagn@microsoft.com","message":":books: migration changes (#1235)","commit_sha":"b828bb1d6c8fb750ad9ef34f8a7a1b7d2574f4c6","commit_date":"2016-11-15 15:08:11 -0500"}],"updated_at":"2017-03-15 06:14 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner","id":"493969"},"contributors":[{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"3/15/2017"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/3115359729431ecbcc16058612da59b85621fa0f/docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md","document_id":"b57be206-ceec-85da-edab-b759162a16e9","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally","toc_asset_id":"articles/csharp/programming-guide/exceptions/toc.json","toc_rel":"toc.json","_op_ogTitle":"How to: Execute Cleanup Code Using finally (C# Programming Guide)","_op_displayDate":null,"_op_displayDate_source":null,"_op_wordCount":299,"_op_rawTitle":"<h1 id=\"how-to-execute-cleanup-code-using-finally-c-programming-guide\" sourcefile=\"docs/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.md\" sourcestartlinenumber=\"38\" sourceendlinenumber=\"38\">How to: Execute Cleanup Code Using finally (C# Programming Guide)</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally","fileRelativePath":"articles/csharp/programming-guide/exceptions/how-to-execute-cleanup-code-using-finally.html"},"themesRelativePathToOutputRoot":"_themes/"}