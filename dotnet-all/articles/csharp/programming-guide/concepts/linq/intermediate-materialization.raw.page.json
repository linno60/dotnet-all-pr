{"content":"<div><div class=\"content\">\n<p>If you are not careful, in some situations you can drastically alter the memory and performance profile of your application by causing premature materialization of collections in your queries. Some standard query operators cause materialization of their source collection before yielding a single element. For example, <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/bb343617(v=vs.110).aspx\" data-linktype=\"external\">Enumerable.OrderBy</a> first iterates through its entire source collection, then sorts all items, and then finally yields the first item. This means that it is expensive to get the first item of an ordered collection; each item thereafter is not expensive. This makes sense: It would be impossible for that query operator to do otherwise.  </p>\n<h2 id=\"example\">Example</h2>\n<p> This example alters the previous example. The <code>AppendString</code> method calls <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/bb342261(v=vs.110).aspx\" data-linktype=\"external\">ToList</a> before iterating through the source. This causes materialization.  </p>\n<pre class=\"loading\"><code class=\"lang-cs\">public static class LocalExtensions  \n{  \n    public static IEnumerable&lt;string&gt;  \n      ConvertCollectionToUpperCase(this IEnumerable&lt;string&gt; source)  \n    {  \n        foreach (string str in source)  \n        {  \n            Console.WriteLine(&quot;ToUpper: source &gt;{0}&lt;&quot;, str);  \n            yield return str.ToUpper();  \n        }  \n    }  \n\n    public static IEnumerable&lt;string&gt;  \n      AppendString(this IEnumerable&lt;string&gt; source, string stringToAppend)  \n    {  \n        // the following statement materializes the source collection in a List&lt;T&gt;  \n        // before iterating through it  \n        foreach (string str in source.ToList())  \n        {  \n            Console.WriteLine(&quot;AppendString: source &gt;{0}&lt;&quot;, str);  \n            yield return str + stringToAppend;  \n        }  \n    }  \n}  \n\nclass Program  \n{  \n    static void Main(string[] args)  \n    {  \n        string[] stringArray = { &quot;abc&quot;, &quot;def&quot;, &quot;ghi&quot; };  \n\n        IEnumerable&lt;string&gt; q1 =  \n            from s in stringArray.ConvertCollectionToUpperCase()  \n            select s;  \n\n        IEnumerable&lt;string&gt; q2 =  \n            from s in q1.AppendString(&quot;!!!&quot;)  \n            select s;  \n\n        foreach (string str in q2)  \n        {  \n            Console.WriteLine(&quot;Main: str &gt;{0}&lt;&quot;, str);  \n            Console.WriteLine();  \n        }  \n    }  \n}  \n</code></pre><p> This example produces the following output:  </p>\n<pre class=\"loading\"><code>ToUpper: source &gt;abc&lt;  \nToUpper: source &gt;def&lt;  \nToUpper: source &gt;ghi&lt;  \nAppendString: source &gt;ABC&lt;  \nMain: str &gt;ABC!!!&lt;  \n\nAppendString: source &gt;DEF&lt;  \nMain: str &gt;DEF!!!&lt;  \n\nAppendString: source &gt;GHI&lt;  \nMain: str &gt;GHI!!!&lt;  \n</code></pre><p> In this example, you can see that the call to <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/bb342261(v=vs.110).aspx\" data-linktype=\"external\">ToList</a> causes <code>AppendString</code> to enumerate its entire source before yielding the first item. If the source were a large array, this would significantly alter the memory profile of the application.  </p>\n<p> Standard query operators can also be chained together. The final topic in this tutorial illustrates this.  </p>\n<ul>\n<li><a href=\"chaining-standard-query-operators-together\" data-linktype=\"relative-path\">Chaining Standard Query Operators Together (C#)</a>  </li>\n</ul>\n<h2 id=\"see-also\">See Also</h2>\n<p> <a href=\"tutorial-chaining-queries-together\" data-linktype=\"relative-path\">Tutorial: Chaining Queries Together (C#)</a></p>\n</div></div>","outputRootRelativePath":"../../../../../","pageMetadata":"<meta name=\"author\" content=\"BillWagner\">\r\n<meta name=\"ms.author\" content=\"wiwagn\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"/dotnet-internal/toc.json\">\r\n<meta name=\"ms.suite\" content=\"\">\r\n<meta name=\"ms.custom\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"7922d38f-5044-41cf-8e17-7173d6553a5e\">\r\n<meta name=\"caps.latest.revision\" content=\"3\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"ms.date\" content=\"2015-07-20\">\r\n<meta name=\"ms.technology\" content=\"devlang-csharp\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"ms.reviewer\" content=\"\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2017-03-21 01:42 AM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/tianzhXamarin/docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md\">\r\n<meta name=\"document_id\" content=\"e6e48976-0bd0-9899-c371-d6f84983474b\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"toc.json\">\r\n","rawMetadata":{"author":"BillWagner","ms.author":"wiwagn","manager":"wpickett","breadcrumb_path":"/dotnet-internal/toc.json","title":"Intermediate Materialization (C#) | Microsoft Docs","ms.suite":"","ms.custom":"","ms.assetid":"7922d38f-5044-41cf-8e17-7173d6553a5e","caps.latest.revision":3,"ms.topic":"article","dev_langs":["csharp"],"ms.date":"2015-07-20","ms.technology":["devlang-csharp"],"ms.prod":".net","ms.reviewer":"","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"Bill Wagner","comitter_email":"wiwagn@microsoft.com","message":":books: migration changes (#1235)","commit_sha":"b828bb1d6c8fb750ad9ef34f8a7a1b7d2574f4c6","commit_date":"2016-11-15 15:08:11 -0500"}],"updated_at":"2017-03-21 01:42 AM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner","id":"493969"},"contributors":[{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"3/21/2017"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/tianzhXamarin/docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md","document_id":"e6e48976-0bd0-9899-c371-d6f84983474b","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/concepts/linq/intermediate-materialization","toc_asset_id":"articles/csharp/programming-guide/concepts/linq/toc.json","toc_rel":"toc.json","_op_ogTitle":"Intermediate Materialization (C#)","_op_displayDate":null,"_op_displayDate_source":null,"_op_wordCount":337,"_op_rawTitle":"<h1 id=\"intermediate-materialization-c\" sourcefile=\"docs/csharp/programming-guide/concepts/linq/intermediate-materialization.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">Intermediate Materialization (C#)</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/concepts/linq/intermediate-materialization","fileRelativePath":"articles/csharp/programming-guide/concepts/linq/intermediate-materialization.html"},"themesRelativePathToOutputRoot":"_themes/"}