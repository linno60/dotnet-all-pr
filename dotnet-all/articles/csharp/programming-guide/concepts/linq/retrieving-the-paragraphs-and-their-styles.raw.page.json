{"content":"<div><div class=\"content\">\n<p>In this example, we write a query that retrieves the paragraph nodes from a WordprocessingML document. It also identifies the style of each paragraph.  </p>\n<p> This query builds on the query in the previous example, <a href=\"finding-the-default-paragraph-style\" data-linktype=\"relative-path\">Finding the Default Paragraph Style (C#)</a>, which retrieves the default style from the list of styles. This information is required so that the query can identify the style of paragraphs that do not have a style explicitly set. Paragraph styles are set through the <code>w:pPr</code> element; if a paragraph does not contain this element, it is formatted with the default style.  </p>\n<p> This topic explains the significance of some pieces of the query, then shows the query as part of a complete, working example.  </p>\n<h2 id=\"example\">Example</h2>\n<p> The source of the query to retrieve all the paragraphs in a document and their styles is as follows:  </p>\n<pre class=\"loading\"><code class=\"lang-cs\">xDoc.Root.Element(w + &quot;body&quot;).Descendants(w + &quot;p&quot;)  \n</code></pre><p> This expression is similar to the source of the query in the previous example, <a href=\"finding-the-default-paragraph-style\" data-linktype=\"relative-path\">Finding the Default Paragraph Style (C#)</a>. The main difference is that it uses the <a class=\"xref\" href=\"../../../../../api/system.xml.linq.xcontainer#System_Xml_Linq_XContainer_Descendants_\" data-linktype=\"relative-path\">Descendants</a> axis instead of the <a class=\"xref\" href=\"../../../../../api/system.xml.linq.xcontainer#System_Xml_Linq_XContainer_Elements_\" data-linktype=\"relative-path\">Elements</a> axis. The query uses the <a class=\"xref\" href=\"../../../../../api/system.xml.linq.xcontainer#System_Xml_Linq_XContainer_Descendants_\" data-linktype=\"relative-path\">Descendants</a> axis because in documents that have sections, the paragraphs will not be the direct children of the body element; rather, the paragraphs will be two levels down in the hierarchy. By using the <a class=\"xref\" href=\"../../../../../api/system.xml.linq.xcontainer#System_Xml_Linq_XContainer_Descendants_\" data-linktype=\"relative-path\">Descendants</a> axis, the code will work of whether or not the document uses sections.  </p>\n<h2 id=\"example-1\">Example</h2>\n<p> The query uses a <code>let</code> clause to determine the element that contains the style node. If there is no element, then <code>styleNode</code> is set to <code>null</code>:  </p>\n<pre class=\"loading\"><code class=\"lang-cs\">let styleNode = para.Elements(w + &quot;pPr&quot;).Elements(w + &quot;pStyle&quot;).FirstOrDefault()  \n</code></pre><p> The <code>let</code> clause first uses the <a class=\"xref\" href=\"../../../../../api/system.xml.linq.xcontainer#System_Xml_Linq_XContainer_Elements_\" data-linktype=\"relative-path\">Elements</a> axis to find all elements named <code>pPr</code>, then uses the <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/bb354751(v=vs.110).aspx\" data-linktype=\"external\">Elements</a> extension method to find all child elements named <code>pStyle</code>, and finally uses the <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/bb358452(v=vs.110).aspx\" data-linktype=\"external\">FirstOrDefault</a> standard query operator to convert the collection to a singleton. If the collection is empty, <code>styleNode</code> is set to <code>null</code>. This is a useful idiom to look for the <code>pStyle</code> descendant node. Note that if the <code>pPr</code> child node does not exist, the code does nor fail by throwing an exception; instead, <code>styleNode</code> is set to <code>null</code>, which is the desired behavior of this <code>let</code> clause.  </p>\n<p> The query projects a collection of an anonymous type with two members, <code>StyleName</code> and <code>ParagraphNode</code>.  </p>\n<h2 id=\"example-2\">Example</h2>\n<p> This example processes a WordprocessingML document, retrieving the paragraph nodes from a WordprocessingML document. It also identifies the style of each paragraph. This example builds on the previous examples in this tutorial. The new query is called out in comments in the code below.  </p>\n<p> You can find instructions for creating the source document for this example in <a href=\"creating-the-source-office-open-xml-document\" data-linktype=\"relative-path\">Creating the Source Office Open XML Document (C#)</a>.  </p>\n<p> This example uses classes found in the WindowsBase assembly. It uses types in the <a class=\"xref\" href=\"../../../../../api/system.io.packaging\" data-linktype=\"relative-path\">System.IO.Packaging</a> namespace.  </p>\n<pre class=\"loading\"><code class=\"lang-cs\">const string fileName = &quot;SampleDoc.docx&quot;;  \n\nconst string documentRelationshipType = &quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument&quot;;  \nconst string stylesRelationshipType = &quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles&quot;;  \nconst string wordmlNamespace = &quot;http://schemas.openxmlformats.org/wordprocessingml/2006/main&quot;;  \nXNamespace w = wordmlNamespace;  \n\nXDocument xDoc = null;  \nXDocument styleDoc = null;  \n\nusing (Package wdPackage = Package.Open(fileName, FileMode.Open, FileAccess.Read))  \n{  \n    PackageRelationship docPackageRelationship = wdPackage.GetRelationshipsByType(documentRelationshipType).FirstOrDefault();  \n    if (docPackageRelationship != null)  \n    {  \n        Uri documentUri = PackUriHelper.ResolvePartUri(new Uri(&quot;/&quot;, UriKind.Relative), docPackageRelationship.TargetUri);  \n        PackagePart documentPart = wdPackage.GetPart(documentUri);  \n\n        //  Load the document XML in the part into an XDocument instance.  \n        xDoc = XDocument.Load(XmlReader.Create(documentPart.GetStream()));  \n\n        //  Find the styles part. There will only be one.  \n        PackageRelationship styleRelation = documentPart.GetRelationshipsByType(stylesRelationshipType).FirstOrDefault();  \n        if (styleRelation != null)  \n        {  \n            Uri styleUri = PackUriHelper.ResolvePartUri(documentUri, styleRelation.TargetUri);  \n            PackagePart stylePart = wdPackage.GetPart(styleUri);  \n\n            //  Load the style XML in the part into an XDocument instance.  \n            styleDoc = XDocument.Load(XmlReader.Create(stylePart.GetStream()));  \n        }  \n    }  \n}  \n\nstring defaultStyle =   \n    (string)(  \n        from style in styleDoc.Root.Elements(w + &quot;style&quot;)  \n        where (string)style.Attribute(w + &quot;type&quot;) == &quot;paragraph&quot;&amp;&amp;  \n              (string)style.Attribute(w + &quot;default&quot;) == &quot;1&quot;  \n              select style  \n    ).First().Attribute(w + &quot;styleId&quot;);  \n\n// Following is the new query that finds all paragraphs in the  \n// document and their styles.  \nvar paragraphs =  \n    from para in xDoc  \n                 .Root  \n                 .Element(w + &quot;body&quot;)  \n                 .Descendants(w + &quot;p&quot;)  \n    let styleNode = para  \n                    .Elements(w + &quot;pPr&quot;)  \n                    .Elements(w + &quot;pStyle&quot;)  \n                    .FirstOrDefault()  \n    select new  \n    {  \n        ParagraphNode = para,  \n        StyleName = styleNode != null ?  \n            (string)styleNode.Attribute(w + &quot;val&quot;) :  \n            defaultStyle  \n    };  \n\nforeach (var p in paragraphs)  \n    Console.WriteLine(&quot;StyleName:{0}&quot;, p.StyleName);  \n</code></pre><p> This example produces the following output when applied to the document described in <a href=\"creating-the-source-office-open-xml-document\" data-linktype=\"relative-path\">Creating the Source Office Open XML Document (C#)</a>.  </p>\n<pre class=\"loading\"><code>StyleName:Heading1  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Code  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Normal  \nStyleName:Code  \n</code></pre><h2 id=\"next-steps\">Next Steps</h2>\n<p> In the next topic, <a href=\"retrieving-the-text-of-the-paragraphs\" data-linktype=\"relative-path\">Retrieving the Text of the Paragraphs (C#)</a>, you&#39;ll create a query to retrieve the text of paragraphs.  </p>\n<h2 id=\"see-also\">See Also</h2>\n<p> <a href=\"tutorial-manipulating-content-in-a-wordprocessingml-document\" data-linktype=\"relative-path\">Tutorial: Manipulating Content in a WordprocessingML Document (C#)</a></p>\n</div></div>","outputRootRelativePath":"../../../../../","pageMetadata":"<meta name=\"author\" content=\"BillWagner\">\r\n<meta name=\"ms.author\" content=\"wiwagn\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"/dotnet-internal/toc2.json\">\r\n<meta name=\"ms.suite\" content=\"\">\r\n<meta name=\"ms.custom\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"c2f767f8-57b1-4b4b-af04-89ffb1f7067d\">\r\n<meta name=\"caps.latest.revision\" content=\"3\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"ms.date\" content=\"2015-07-20\">\r\n<meta name=\"ms.technology\" content=\"devlang-csharp\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"ms.reviewer\" content=\"\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2016-12-15 06:00 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md\">\r\n<meta name=\"document_id\" content=\"3dca86e8-b3c5-c15a-239d-69cd5f067ef9\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"toc2.json\">\r\n","rawMetadata":{"author":"BillWagner","ms.author":"wiwagn","manager":"wpickett","breadcrumb_path":"/dotnet-internal/toc.json","title":"Retrieving the Paragraphs and Their Styles (C#) | Microsoft Docs","ms.suite":"","ms.custom":"","ms.assetid":"c2f767f8-57b1-4b4b-af04-89ffb1f7067d","caps.latest.revision":3,"ms.topic":"article","dev_langs":["csharp"],"ms.date":"2015-07-20","ms.technology":["devlang-csharp"],"ms.prod":".net","ms.reviewer":"","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"Bill Wagner","comitter_email":"wiwagn@microsoft.com","message":":books: migration changes (#1235)","commit_sha":"b828bb1d6c8fb750ad9ef34f8a7a1b7d2574f4c6","commit_date":"2016-11-15 15:08:11 -0500"}],"updated_at":"2016-12-15 06:00 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner","id":"493969"},"contributors":[{"profile_url":"https://github.com/BillWagner","display_name":"Bill Wagner"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"12/15/2016"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md","document_id":"3dca86e8-b3c5-c15a-239d-69cd5f067ef9","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles","toc_asset_id":"articles/csharp/programming-guide/concepts/linq/toc.json","toc_rel":"toc.json","_op_ogTitle":"Retrieving the Paragraphs and Their Styles (C#)","_op_displayDate":null,"_op_displayDate_source":null,"_op_wordCount":732,"_op_rawTitle":"<h1 id=\"retrieving-the-paragraphs-and-their-styles-c\" sourcefile=\"docs/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.md\" sourcestartlinenumber=\"20\" sourceendlinenumber=\"20\">Retrieving the Paragraphs and Their Styles (C#)</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/articles/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles","fileRelativePath":"articles/csharp/programming-guide/concepts/linq/retrieving-the-paragraphs-and-their-styles.html"},"themesRelativePathToOutputRoot":"_themes/"}