{"content":"<div><div class=\"content\">\n<p><em>Reference cells</em> are storage locations that enable you to create mutable values with reference semantics.</p>\n<h2 id=\"syntax\">Syntax</h2>\n<pre class=\"loading\"><code class=\"lang-fsharp\">ref expression\n</code></pre><h2 id=\"remarks\">Remarks</h2>\n<p>You use the <code>ref</code> operator before a value to create a new reference cell that encapsulates the value. You can then change the underlying value because it is mutable.</p>\n<p>A reference cell holds an actual value; it is not just an address. When you create a reference cell by using the <code>ref</code> operator, you create a copy of the underlying value as an encapsulated mutable value.</p>\n<p>You can dereference a reference cell by using the <code>!</code> (bang) operator.</p>\n<p>The following code example illustrates the declaration and use of reference cells.</p>\n<pre><code class=\"lang-fsharp\" name=\"Main\">// Declare a reference.\nlet refVar = ref 6\n\n// Change the value referred to by the reference.\nrefVar := 50\n\n// Dereference by using the ! operator.\nprintfn &quot;%d&quot; !refVar\n</code></pre><p>The output is <code>50</code>.</p>\n<p>Reference cells are instances of the <code>Ref</code> generic record type, which is declared as follows.</p>\n<pre class=\"loading\"><code class=\"lang-fsharp\">type Ref&lt;&#39;a&gt; =\n{ mutable contents: &#39;a }\n</code></pre><p>The type <code>&#39;a ref</code> is a synonym for <code>Ref&lt;&#39;a&gt;</code>. The compiler and IntelliSense in the IDE display the former for this type, but the underlying definition is the latter.</p>\n<p>The <code>ref</code> operator creates a new reference cell. The following code is the declaration of the <code>ref</code> operator.</p>\n<pre class=\"loading\"><code class=\"lang-fsharp\">let ref x = { contents = x }\n</code></pre><p>The following table shows the features that are available on the reference cell.</p>\n<table>\n<thead>\n<tr>\n<th>Operator, member, or field</th>\n<th>Description</th>\n<th>Type</th>\n<th>Definition</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>!</code> (dereference operator)</td>\n<td>Returns the underlying value.</td>\n<td><code>&#39;a ref -&gt; &#39;a</code></td>\n<td><code>let (!) r = r.contents</code></td>\n</tr>\n<tr>\n<td><code>:=</code> (assignment operator)</td>\n<td>Changes the underlying value.</td>\n<td><code>&#39;a ref -&gt; &#39;a -&gt; unit</code></td>\n<td><code>let (:=) r x = r.contents &lt;- x</code></td>\n</tr>\n<tr>\n<td><code>ref</code> (operator)</td>\n<td>Encapsulates a value into a new reference cell.</td>\n<td><code>&#39;a -&gt; &#39;a ref</code></td>\n<td><code>let ref x = { contents = x }</code></td>\n</tr>\n<tr>\n<td><code>Value</code> (property)</td>\n<td>Gets or sets the underlying value.</td>\n<td><code>unit -&gt; &#39;a</code></td>\n<td><code>member x.Value = x.contents</code></td>\n</tr>\n<tr>\n<td><code>contents</code> (record field)</td>\n<td>Gets or sets the underlying value.</td>\n<td><code>&#39;a</code></td>\n<td><code>let ref x = { contents = x }</code></td>\n</tr>\n</tbody>\n</table>\n<p>There are several ways to access the underlying value. The value returned by the dereference operator (<code>!</code>) is not an assignable value. Therefore, if you are modifying the underlying value, you must use the assignment operator (<code>:=</code>) instead.</p>\n<p>Both the <code>Value</code> property and the <code>contents</code> field are assignable values. Therefore, you can use these to either access or change the underlying value, as shown in the following code.</p>\n<pre><code class=\"lang-fsharp\" name=\"Main\">let xRef : int ref = ref 10\n\nprintfn &quot;%d&quot; (xRef.Value)\nprintfn &quot;%d&quot; (xRef.contents)\n\nxRef.Value &lt;- 11\nprintfn &quot;%d&quot; (xRef.Value)\nxRef.contents &lt;- 12\nprintfn &quot;%d&quot; (xRef.contents)\n</code></pre><p>The output is as follows.</p>\n<pre class=\"loading\"><code>10\n10\n11\n12\n</code></pre><p>The field <code>contents</code> is provided for compatibility with other versions of ML and will produce a warning during compilation. To disable the warning, use the <code>--mlcompatibility</code> compiler option. For more information, see <a href=\"compiler-options\" data-linktype=\"relative-path\">Compiler Options</a>.</p>\n<p>The following code illustrates the use of reference cells in parameter passing. The Incrementor type has a method Increment that takes a parameter that includes byref in the parameter type. The byref in the parameter type indicates that callers must pass a reference cell or the address of a typical variable of the specified type, in this case int. The remaining code illustrates how to call Increment with both of these types of arguments, and shows the use of the ref operator on a variable to create a reference cell (ref myDelta1). It then shows the use of the address-of operator (&amp;) to generate an appropriate argument. Finally, the Increment method is called again by using a reference cell that is declared by using a let binding. The final line of code demonstrates the use of the ! operator to dereference the reference cell for printing.</p>\n<pre><code class=\"lang-fsharp\" name=\"Main\">type Incrementor(delta) =\n    member this.Increment(i : int byref) =\n        i &lt;- i + delta\n\nlet incrementor = new Incrementor(1)\nlet mutable myDelta1 = 10\nincrementor.Increment(ref myDelta1)\n// Prints 10:\nprintfn &quot;%d&quot; myDelta1\n\nlet mutable myDelta2 = 10\nincrementor.Increment(&amp;myDelta2)\n// Prints 11:\nprintfn &quot;%d&quot; myDelta2\n\nlet refInt = ref 10\nincrementor.Increment(refInt)\n// Prints 11:\nprintfn &quot;%d&quot; !refInt\n</code></pre><p>For more information about how to pass by reference, see <a href=\"parameters-and-arguments\" data-linktype=\"relative-path\">Parameters and Arguments</a>.</p>\n<div class=\"NOTE\"><h5>Note</h5><p>C# programmers should know that ref works differently in F# than it does in C#. For example, the use of ref when you pass an argument does not have the same effect in F# as it does in C#.</p>\n</div>\n<h2 id=\"reference-cells-vs-mutable-variables\">Reference Cells vs. Mutable Variables</h2>\n<p>Reference cells and mutable variables can often be used in the same situations. However, there are some situations in which mutable variables cannot be used, and you must use a reference cell instead. In general, you should prefer mutable variables where they are accepted by the compiler. However, in expressions that generate closures, the compiler will report that you cannot use mutable variables. <em>Closures</em> are local functions that are generated by certain F# expressions, such as lambda expressions, sequence expressions, computation expressions, and curried functions that use partially applied arguments. The closures generated by these expressions are stored for later evaluation. This process is not compatible with mutable variables. Therefore, if you need mutable state in such an expression, you have to use reference cells. For more information about closures, see Closures (F#).</p>\n<p>The following code example demonstrates the scenario in which you must use a reference cell.</p>\n<pre><code class=\"lang-fsharp\" name=\"Main\">// Print all the lines read in from the console.\nlet PrintLines1() =\n    let mutable finished = false\n    while not finished do\n        match System.Console.ReadLine() with\n        | null -&gt; finished &lt;- true\n        | s -&gt; printfn &quot;line is: %s&quot; s\n\n\n// Attempt to wrap the printing loop into a\n// sequence expression to delay the computation.\nlet PrintLines2() =\n    seq {\n        let mutable finished = false\n        // Compiler error:\n        while not finished do\n            match System.Console.ReadLine() with\n            | null -&gt; finished &lt;- true\n            | s -&gt; yield s\n    }\n\n// You must use a reference cell instead.\nlet PrintLines3() =\n    seq {\n        let finished = ref false\n        while not !finished do\n            match System.Console.ReadLine() with\n            | null -&gt; finished := true\n            | s -&gt; yield s\n    }\n</code></pre><p>In the previous code, the reference cell <code>finished</code> is included in local state, that is, variables that are in the closure are created and used entirely within the expression, in this case a sequence expression. Consider what occurs when the variables are non-local. Closures can also access non-local state, but when this occurs, the variables are copied and stored by value. This process is known as <em>value semantics</em>. This means that the values at the time of the copy are stored, and any subsequent changes to the variables are not reflected. If you want to track the changes of non-local variables, or, in other words, if you need a closure that interacts with non-local state by using <em>reference semantics</em>, you must use a reference cell.</p>\n<p>The following code examples demonstrate the use of reference cells in closures. In this case, the closure results from the partial application of function arguments.</p>\n<pre><code class=\"lang-fsharp\" name=\"Main\">// The following code demonstrates the use of reference\n// cells to enable partially applied arguments to be changed\n// by later code.\n\nlet increment1 delta number = number + delta\n\nlet mutable myMutableIncrement = 10\n\n// Closures created by partial application and literals.\nlet incrementBy1 = increment1 1\nlet incrementBy2 = increment1 2\n\n// Partial application of one argument from a mutable variable.\nlet incrementMutable = increment1 myMutableIncrement\n\nmyMutableIncrement &lt;- 12\n\n// This line prints 110.\nprintfn &quot;%d&quot; (incrementMutable 100)\n\nlet myRefIncrement = ref 10\n\n// Partial application of one argument, dereferenced\n// from a reference cell.\nlet incrementRef = increment1 !myRefIncrement\n\nmyRefIncrement := 12\n\n// This line also prints 110.\nprintfn &quot;%d&quot; (incrementRef 100)\n\n// Reset the value of the reference cell.\nmyRefIncrement := 10\n\n// New increment function takes a reference cell.\nlet increment2 delta number = number + !delta\n\n// Partial application of one argument, passing a reference cell\n// without dereferencing first.\nlet incrementRef2 = increment2 myRefIncrement\n\nmyRefIncrement := 12\n\n// This line prints 112.\nprintfn &quot;%d&quot; (incrementRef2 100)\n</code></pre><h2 id=\"see-also\">See Also</h2>\n<p><a href=\"index\" data-linktype=\"relative-path\">F# Language Reference</a></p>\n<p><a href=\"parameters-and-arguments\" data-linktype=\"relative-path\">Parameters and Arguments</a></p>\n<p><a href=\"symbol-and-operator-reference/index\" data-linktype=\"relative-path\">Symbol and Operator Reference</a></p>\n</div></div>","outputRootRelativePath":"../../../","pageMetadata":"<meta name=\"author\" content=\"cartermp\">\r\n<meta name=\"ms.author\" content=\"phcart\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"ms.devlang\" content=\"fsharp\">\r\n<meta name=\"ms.assetid\" content=\"09a0b221-ea21-45c4-bae8-5e4a339750c4\">\r\n<meta name=\"description\" content=\"Reference Cells (F#)\">\r\n<meta name=\"keywords\" content=\"visual f#, f#, functional programming\">\r\n<meta name=\"ms.topic\" content=\"language-reference\">\r\n<meta name=\"ms.date\" content=\"05/16/2016\">\r\n<meta name=\"ms.technology\" content=\"devlang-fsharp\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2016-12-15 06:00 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/fsharp/language-reference/reference-cells.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/fsharp/language-reference/reference-cells.md\">\r\n<meta name=\"document_id\" content=\"863da465-3157-b498-d1df-77501963dc45\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"../../toc2.json\">\r\n","rawMetadata":{"author":"cartermp","ms.author":"phcart","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","title":"Reference Cells (F#) | Microsoft Docs","ms.devlang":"fsharp","ms.assetid":"09a0b221-ea21-45c4-bae8-5e4a339750c4","description":"Reference Cells (F#)","keywords":"visual f#, f#, functional programming","ms.topic":"language-reference","ms.date":"05/16/2016","ms.technology":"devlang-fsharp","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Fix up HTML escaping in Reference Cells table (#1021)","commit_sha":"e402661aef57d932cd77ae07290c939be963f81f","commit_date":"2016-09-14 09:56:04 -0700"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Move snippets to snippets folder, now with some F# (#904)","commit_sha":"37fe2b89d590509e8eb14342da988f15862a9e2b","commit_date":"2016-08-13 16:40:56 -0700"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Reorganize F# snippets (#903)","commit_sha":"6ea1cf8f3779532a9ed8fbdac32592fbb809443c","commit_date":"2016-08-13 15:14:41 -0700"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"F# Docs: Update intro, move files, rename language reference for better URLS (#902)","commit_sha":"70a10b9c3e21291c96d927d13f8710d9e0738d4c","commit_date":"2016-08-13 11:22:39 -0700"}],"updated_at":"2016-12-15 06:00 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/cartermp","display_name":"Phillip Carter","id":"6309070"},"contributors":[{"profile_url":"https://github.com/cartermp","display_name":"Phillip Carter"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"12/15/2016"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/fsharp/language-reference/reference-cells.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/fsharp/language-reference/reference-cells.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/fsharp/language-reference/reference-cells.md","document_id":"863da465-3157-b498-d1df-77501963dc45","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet/articles/fsharp/language-reference/reference-cells","toc_asset_id":"articles/toc.json","toc_rel":"../../toc.json","_op_ogTitle":"Reference Cells (F#)","_op_displayDate":"2016-5-16","_op_displayDate_source":"2016-05-16T00:00:00Z","_op_wordCount":1334,"_op_rawTitle":"<h1 id=\"reference-cells\" sourcefile=\"docs/fsharp/language-reference/reference-cells.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\">Reference Cells</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/articles/fsharp/language-reference/reference-cells","fileRelativePath":"articles/fsharp/language-reference/reference-cells.html"},"themesRelativePathToOutputRoot":"_themes/"}