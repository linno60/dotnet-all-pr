{"content":"<div><div class=\"content\">\n<div class=\"NOTE\"><h5>Note</h5><p>This guide was written for F# 3.0 and will be updated.  See <a href=\"http://fsharp.github.io/FSharp.Data/\" data-linktype=\"external\">FSharp.Data</a> for up-to-date, cross-platform type providers.</p>\n</div>\n<div class=\"NOTE\"><h5>Note</h5><p>The API reference links will take you to MSDN.  The docs.microsoft.com API reference is not complete.</p>\n</div>\n<p>This walkthrough for F# 3.0 shows you how to access typed data for a SQL database based on the ADO.NET Entity Data Model. This walkthrough shows you how to set up the F# <code>SqlEntityConnection</code> type provider for use with a SQL database, how to write queries against the data, how to call stored procedures on the database, as well as how to use some of the ADO.NET Entity Framework types and methods to update the database.</p>\n<p>This walkthrough illustrates the following tasks, which you should perform in this order for the walkthrough to succeed:</p>\n<ul>\n<li><p>Create the School database\n<br></p>\n</li>\n<li><p>Create and configure an F# project\n<br></p>\n</li>\n<li><p>Configure the type provider and connect to the Entity Data Model\n<br></p>\n</li>\n<li><p>Query the database\n<br></p>\n</li>\n<li><p>Updating the database\n<br></p>\n</li>\n</ul>\n<h2 id=\"prerequisites\">Prerequisites</h2>\n<p>You must have access to a server that&#39;s running SQL Server where you can create a database to complete these steps.</p>\n<h2 id=\"create-the-school-database\">Create the School database</h2>\n<p>You can create the School database on any server that&#39;s running SQL Server to which you have administrative access, or you can use LocalDB.</p>\n<h4 id=\"to-create-the-school-database\">To create the School database</h4>\n<ol>\n<li><p>In <strong>Server Explorer</strong>, open the shortcut menu for the <strong>Data Connections</strong> node, and then choose <strong>Add Connection</strong>.\n<br>  The <strong>Add Connection</strong> dialog box appears.\n<br></p>\n</li>\n<li><p>In the <strong>Server name</strong> box, specify the name of an instance of SQL Server to which you have administrative access, or specify (localdb\\v11.0) if you don&#39;t have access to a server.\n<br>  SQL Server Express LocalDB provides a lightweight database server for development and testing on your machine. For more information about LocalDB, see <a href=\"https://msdn.microsoft.com/library/ms233763.aspx\" data-linktype=\"external\">Walkthrough: Creating a Local Database File in Visual Studio</a>.\n<br>  A new node is created in <strong>Server Explorer</strong> under <strong>Data Connections</strong>.\n<br></p>\n</li>\n<li><p>Open the shortcut menu for the new connection node, and then choose <strong>New Query</strong>.\n<br></p>\n</li>\n<li><p>Open <a href=\"http://go.microsoft.com/fwlink/?LinkID=237278\" data-linktype=\"external\">Creating the School Sample Database</a> on the Microsoft website, and then copy and paste the database script that creates the Student database into the editor window.\n<br></p>\n</li>\n</ol>\n<h2 id=\"a-namebkmkcreateconfigfsproj-a\"><a name=\"BKMK_CreateConfigFSProj\"> </a></h2>\n<h2 id=\"create-and-configure-an-f-project\">Create and configure an F# project</h2>\n<p>In this step, you create a project and set it up to use a type provider.</p>\n<h4 id=\"to-create-and-configure-an-f-project\">To create and configure an F# project</h4>\n<ol>\n<li><p>Close the previous project, create another project, and name it <strong>SchoolEDM</strong>.\n<br></p>\n</li>\n<li><p>In <strong>Solution Explorer</strong>, open the shortcut menu for <strong>References</strong>, and then choose <strong>Add Reference</strong>.\n<br></p>\n</li>\n<li><p>Choose the <strong>Framework</strong> node, and then, in the <strong>Framework</strong> list, choose <strong>System.Data</strong>, <strong>System.Data.Entity</strong>,  and <strong>System.Data.Linq</strong>.\n<br></p>\n</li>\n<li><p>Choose the <strong>Extensions</strong> node, add a reference to the <a href=\"https://msdn.microsoft.com/library/a858f859-047a-44ab-945b-8731d7a0e6e3\" data-linktype=\"external\">FSharp.Data.TypeProviders</a> assembly, and then choose the <strong>OK</strong> button to dismiss the dialog box.\n<br></p>\n</li>\n<li><p>Add the following code to define an internal module and open appropriate namespaces. The type provider can inject types only into a private or internal namespace.\n<br></p>\n</li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">module internal SchoolEDM\n\nopen System.Data.Linq\nopen System.Data.Entity\nopen Microsoft.FSharp.Data.TypeProviders\n</code></pre><ol>\n<li>To run the code in this walkthrough interactively as a script instead of as a compiled program, open the shortcut menu for the project node, choose <strong>Add New Item</strong>, add an F# script file, and then add the code in each step to the script. To load the assembly references, add the following lines.\n<br></li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">#r &quot;System.Data.Entity.dll&quot;\n#r &quot;FSharp.Data.TypeProviders.dll&quot;\n#r &quot;System.Data.Linq.dll&quot;\n</code></pre><ol>\n<li>Highlight each block of code as you add it, and choose the Alt + Enter keys to run it in F# Interactive.\n<br></li>\n</ol>\n<h2 id=\"configure-the-type-provider-and-connect-to-the-entity-data-model\">Configure the type provider, and connect to the Entity Data Model</h2>\n<p>In this step, you set up a type provider with a data connection and obtain a data context that allows you to work with data.</p>\n<h4 id=\"to-configure-the-type-provider-and-connect-to-the-entity-data-model\">To configure the type provider, and connect to the Entity Data Model</h4>\n<ol>\n<li>Enter the following code to configure the <code>SqlEntityConnection</code> type provider that generates F# types based on the Entity Data Model that you created previously. Instead of the full EDMX connection string, use only the SQL connection string.\n<br></li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">type private EntityConnection = SqlEntityConnection&lt;ConnectionString=&quot;Server=SERVER\\InstanceName;Initial Catalog=School;Integrated Security=SSPI;MultipleActiveResultSets=true&quot;,Pluralize = true&gt;\n</code></pre><p>  This action sets up a type provider with the database connection that you created earlier. The property <code>MultipleActiveResultSets</code> is needed when you use the ADO.NET Entity Framework because this property allows multiple commands to execute asynchronously on the database in one connection, which can occur frequently in ADO.NET Entity Framework code. For more information, see <a href=\"http://go.microsoft.com/fwlink/?LinkId=236929\" data-linktype=\"external\">Multiple Active Result Sets (MARS)</a>.\n<br></p>\n<ol>\n<li>Get the data context, which is an object that contains the database tables as properties and the database stored procedures and functions as methods.\n<br></li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">let context = EntityConnection.GetDataContext()\n</code></pre><h2 id=\"querying-the-database\">Querying the database</h2>\n<p>In this step, you use F# query expressions to execute various queries on the database.</p>\n<h4 id=\"to-query-the-data\">To query the data</h4>\n<ul>\n<li>Enter the following code to query the data from the entity data model. Note the effect of Pluralize = true, which changes the database table Course to Courses and Person to People.\n<br></li>\n</ul>\n<pre class=\"loading\"><code class=\"lang-fsharp\">query { \n  for course in context.Courses do\n  select course\n} |&gt; Seq.iter (fun course -&gt; printfn &quot;%s&quot; course.Title)\n\nquery { \n  for person in context.People do\n  select person \n} |&gt; Seq.iter (fun person -&gt; printfn &quot;%s %s&quot; person.FirstName person.LastName)\n\n// Add a where clause to filter results.\nquery {\n  for course in context.Courses do\n  where (course.DepartmentID = 1)\n  select course\n} |&gt; Seq.iter (fun course -&gt; printfn &quot;%s&quot; course.Title)\n\n// Join two tables.\nquery { \n  for course in context.Courses do\n  join dept in context.Departments on (course.DepartmentID = dept.DepartmentID)\n  select (course, dept.Name) \n} |&gt; Seq.iter (fun (course, deptName) -&gt; printfn &quot;%s %s&quot; course.Title deptName)\n</code></pre><h2 id=\"updating-the-database\">Updating the database</h2>\n<p>To update the database, you use the Entity Framework classes and methods. You can use two types of data context with the SQLEntityConnection type provider. First, <code>ServiceTypes.SimpleDataContextTypes.EntityContainer</code> is the simplified data context, which includes only the provided properties that represent database tables and columns. Second, the full data context is an instance of the Entity Framework class <code>System.Data.Objects.ObjectContext</code>, which contains the method <code>System.Data.Objects.ObjectContext.AddObject(System.String,System.Object)</code> to add rows to the database. The Entity Framework recognizes the tables and the relationships between them, so it enforces database consistency.</p>\n<h4 id=\"to-update-the-database\">To update the database</h4>\n<ol>\n<li>Add the following code to your program. In this example, you add two objects with a relationship between them, and you add an instructor and an office assignment. The table <code>OfficeAssignments</code> contains the <code>InstructorID</code> column, which references the <code>PersonID</code> column in the <code>Person</code> table.\n<br></li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">// The full data context\nlet fullContext = context.DataContext\n\n// A helper function.\nlet nullable value = new System.Nullable&lt;_&gt;(value)\n\nlet addInstructor(lastName, firstName, hireDate, office) =\n  let hireDate = DateTime.Parse(hireDate)\n  let newPerson = new EntityConnection.ServiceTypes.Person(LastName = lastName,\n                                                           FirstName = firstName,\n                                                           HireDate = nullable hireDate)\n  fullContext.AddObject(&quot;People&quot;, newPerson)\n\n  let newOffice = new EntityConnection.ServiceTypes.OfficeAssignment(Location = office)\n\n  fullContext.AddObject(&quot;OfficeAssignments&quot;, newOffice)\n  fullContext.CommandTimeout &lt;- nullable 1000\n  fullContext.SaveChanges() |&gt; printfn &quot;Saved changes: %d object(s) modified.&quot;\n\naddInstructor(&quot;Parker&quot;, &quot;Darren&quot;, &quot;1/1/1998&quot;, &quot;41/3720&quot;)\n</code></pre><p>Nothing is changed in the database until you call <code>System.Data.Objects.ObjectContext.SaveChanges</code>.\n<br></p>\n<ol>\n<li>Now restore the database to its earlier state by deleting the objects that you added.\n<br></li>\n</ol>\n<pre class=\"loading\"><code class=\"lang-fsharp\">let deleteInstructor(lastName, firstName) =\n  query {\n    for person in context.People do\n    where (person.FirstName = firstName &amp;&amp;\n           person.LastName = lastName)\n    select person\n  } |&gt; Seq.iter (fun person-&gt;\n                    query {\n                      for officeAssignment in context.OfficeAssignments do\n                      where (officeAssignment.Person.PersonID = person.PersonID)\n                      select officeAssignment\n                    } |&gt; Seq.iter (fun officeAssignment -&gt; fullContext.DeleteObject(officeAssignment))\n\n                    fullContext.DeleteObject(person))\n\n  // The call to SaveChanges should be outside of any iteration on the queries.\n  fullContext.SaveChanges() |&gt; printfn &quot;Saved changed: %d object(s) modified.&quot;\n\ndeleteInstructor(&quot;Parker&quot;, &quot;Darren&quot;)\n</code></pre><div class=\"WARNING\"><h5>Warning</h5><p>When you use a query expression, you must remember that the query is subject to lazy evaluation. Therefore, the database is still open for reading during any chained evaluations, such as in the lambda expression blocks after each query expression. Any database operation that explicitly or implicitly uses a transaction must occur after the read operations have completed.</p>\n</div>\n<h2 id=\"next-steps\">Next Steps</h2>\n<p>Explore other query options by reviewing the query operators available in <a href=\"../../language-reference/query-expressions\" data-linktype=\"relative-path\">Query Expressions</a>, and also review the <a href=\"https://msdn.microsoft.com/library/bb399572\" data-linktype=\"external\">ADO.NET Entity Framework</a> to understand what functionality is available to you when you use this type provider.</p>\n<h2 id=\"see-also\">See Also</h2>\n<p><a href=\"index\" data-linktype=\"relative-path\">Type Providers</a></p>\n<p><a href=\"https://msdn.microsoft.com/visualfsharpdocs/conceptual/sqlentityconnection-type-provider-%5bfsharp%5d\" data-linktype=\"external\">SqlEntityConnection Type Provider</a></p>\n<p><a href=\"generating-fsharp-types-from-edmx\" data-linktype=\"relative-path\">Walkthrough: Generating F# Types from an EDMX Schema File</a></p>\n<p><a href=\"https://msdn.microsoft.com/library/bb399572\" data-linktype=\"external\">ADO.NET Entity Framework</a></p>\n<p><a href=\"https://msdn.microsoft.com/library/f4c8e7ce-1db6-417e-9759-15f8b55155d4\" data-linktype=\"external\">.edmx File Overview</a></p>\n<p><a href=\"https://msdn.microsoft.com/library/bb387165\" data-linktype=\"external\">EDM Generator &#40;EdmGen.exe&#41;</a></p>\n</div></div>","outputRootRelativePath":"../../../../","pageMetadata":"<meta name=\"author\" content=\"cartermp\">\r\n<meta name=\"ms.author\" content=\"phcart\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"ms.devlang\" content=\"fsharp\">\r\n<meta name=\"ms.assetid\" content=\"dc82a932-5401-4d19-9fb3-92c50d8db514\">\r\n<meta name=\"description\" content=\"Walkthrough: Accessing a SQL Database by Using Type Providers and Entities (F#)\">\r\n<meta name=\"keywords\" content=\"visual f#, f#, functional programming\">\r\n<meta name=\"ms.topic\" content=\"language-reference\">\r\n<meta name=\"ms.date\" content=\"05/16/2016\">\r\n<meta name=\"ms.technology\" content=\"devlang-fsharp\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2016-12-15 06:00 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md\">\r\n<meta name=\"document_id\" content=\"4501f4c2-b5ac-9a8d-3452-78d8ade14290\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"../../../toc2.json\">\r\n","rawMetadata":{"author":"cartermp","ms.author":"phcart","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","title":"Walkthrough: Accessing a SQL Database by Using Type Providers and Entities (F#) | Microsoft Docs","ms.devlang":"fsharp","ms.assetid":"dc82a932-5401-4d19-9fb3-92c50d8db514","description":"Walkthrough: Accessing a SQL Database by Using Type Providers and Entities (F#)","keywords":"visual f#, f#, functional programming","ms.topic":"language-reference","ms.date":"05/16/2016","ms.technology":"devlang-fsharp","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Absolute urls and other fixes (#1281)","commit_sha":"f7dffe4885b331cec8d37f3cc5c9163f69c3b4c9","commit_date":"2016-11-22 12:57:26 -0800"},{"author_name":"Jason Nguyen","author_email":"gofightnguyen@hotmail.com","committer_name":"Phillip Carter","comitter_email":"phillip.carter@outlook.com","message":"Update accessing-a-sql-database-entities.md (#1111)","commit_sha":"f78d6c0c5a011f060d5bc9ba25477005d7258f7a","commit_date":"2016-10-05 09:57:58 -0700"},{"author_name":"Jason Nguyen","author_email":"gofightnguyen@hotmail.com","committer_name":"Maira Wenzel","comitter_email":"mairaw@microsoft.com","message":"Update accessing-a-sql-database-entities.md (#1106)","commit_sha":"ba84b4a8e3cfe0da9341ef059699637fda4320e2","commit_date":"2016-10-03 16:05:16 -0700"},{"author_name":"Petr Onderka","author_email":"gsvick@gmail.com","committer_name":"Maira Wenzel","comitter_email":"mairaw@microsoft.com","message":"Improve titles of some F# articles (#1003)","commit_sha":"d18cfd736f1dbd61ab9e209de4aaa878a88162cd","commit_date":"2016-09-03 11:22:59 -0700"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"F# Docs: Update intro, move files, rename language reference for better URLS (#902)","commit_sha":"70a10b9c3e21291c96d927d13f8710d9e0738d4c","commit_date":"2016-08-13 11:22:39 -0700"},{"author_name":"Phillip Carter","author_email":"phillip.carter@outlook.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Add Visual F# Conceptual Content (#900)","commit_sha":"c27bed7dbad6b24c55734fcab0333bd3a1de85d6","commit_date":"2016-08-12 17:06:05 -0700"}],"updated_at":"2016-12-15 06:00 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/cartermp","display_name":"Phillip Carter","id":"6309070"},"contributors":[{"profile_url":"https://github.com/cartermp","display_name":"Phillip Carter"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"},{"profile_url":"https://github.com/GoFightNguyen","display_name":"Jason Nguyen","id":"6308176"},{"profile_url":"https://github.com/svick","display_name":"Petr Onderka","id":"287848"}],"update_at":"12/15/2016"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md","document_id":"4501f4c2-b5ac-9a8d-3452-78d8ade14290","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet/articles/fsharp/tutorials/type-providers/accessing-a-sql-database-entities","toc_asset_id":"articles/toc.json","toc_rel":"../../../toc.json","_op_ogTitle":"Walkthrough: Accessing a SQL Database by Using Type Providers and Entities (F#)","_op_displayDate":"2016-5-16","_op_displayDate_source":"2016-05-16T00:00:00Z","_op_wordCount":1317,"_op_rawTitle":"<h1 id=\"walkthrough-accessing-a-sql-database-by-using-type-providers-and-entities\" sourcefile=\"docs/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.md\" sourcestartlinenumber=\"15\" sourceendlinenumber=\"15\">Walkthrough: Accessing a SQL Database by Using Type Providers and Entities</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/articles/fsharp/tutorials/type-providers/accessing-a-sql-database-entities","fileRelativePath":"articles/fsharp/tutorials/type-providers/accessing-a-sql-database-entities.html"},"themesRelativePathToOutputRoot":"_themes/"}