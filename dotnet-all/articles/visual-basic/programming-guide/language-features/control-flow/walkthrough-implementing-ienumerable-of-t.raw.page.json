{"content":"<div><div class=\"content\">\n<p>The <a class=\"xref\" href=\"../../../../../api/system.collections.generic.ienumerable-1\" data-linktype=\"relative-path\">IEnumerable&lt;T&gt;</a> interface is implemented by classes that can return a sequence of values one item at a time. The advantage of returning data one item at a time is that you do not have to load the complete set of data into memory to work with it. You only have to use sufficient memory to load a single item from the data. Classes that implement the <code>IEnumerable(T)</code> interface can be used with <code>For Each</code> loops or LINQ queries.  </p>\n<p> For example, consider an application that must read a large text file and return each line from the file that matches particular search criteria. The application uses a LINQ query to return lines from the file that match the specified criteria. To query the contents of the file by using a LINQ query, the application could load the contents of the file into an array or a collection. However, loading the whole file into an array or collection would consume far more memory than is required. The LINQ query could instead query the file contents by using an enumerable class, returning only values that match the search criteria. Queries that return only a few matching values would consume far less memory.  </p>\n<p> You can create a class that implements the <a class=\"xref\" href=\"../../../../../api/system.collections.generic.ienumerable-1\" data-linktype=\"relative-path\">IEnumerable&lt;T&gt;</a> interface to expose source data as enumerable data. Your class that implements the <code>IEnumerable(T)</code> interface will require another class that implements the <a class=\"xref\" href=\"../../../../../api/system.collections.generic.ienumerator-1\" data-linktype=\"relative-path\">IEnumerator&lt;T&gt;</a> interface to iterate through the source data. These two classes enable you to return items of data sequentially as a specific type.  </p>\n<p> In this walkthrough, you will create a class that implements the <code>IEnumerable(Of String)</code> interface and a class that implements the <code>IEnumerator(Of String)</code> interface to read a text file one line at a time.  </p>\n<div class=\"NOTE\"><h5>Note</h5><p>Your computer might show different names or locations for some of the Visual Studio user interface elements in the following instructions. The Visual Studio edition that you have and the settings that you use determine these elements. For more information, see <a href=\"https://docs.microsoft.com/visualstudio/ide/personalizing-the-visual-studio-ide\" data-linktype=\"external\">Personalizing the IDE</a>.</p>\n</div>\n<h2 id=\"creating-the-enumerable-class\">Creating the Enumerable Class</h2>\n<table>\n<thead>\n<tr>\n<th>To create the enumerable class project</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.  In Visual Basic, on the <strong>File</strong> menu, point to <strong>New</strong> and then click <strong>Project</strong>.<br>2.  In the <strong>New Project</strong> dialog box, in the <strong>Project Types</strong> pane, make sure that <strong>Windows</strong> is selected. Select <strong>Class Library</strong> in the <strong>Templates</strong> pane. In the <strong>Name</strong> box, type <code>StreamReaderEnumerable</code>, and then click <strong>OK</strong>. The new project is displayed.<br>3.  In <strong>Solution Explorer</strong>, right-click the Class1.vb file and click <strong>Rename</strong>. Rename the file to <code>StreamReaderEnumerable.vb</code> and press ENTER. Renaming the file will also rename the class to <code>StreamReaderEnumerable</code>. This class will implement the <code>IEnumerable(Of String)</code> interface.<br>4.  Right-click the StreamReaderEnumerable project, point to <strong>Add</strong>, and then click <strong>New Item</strong>. Select the <strong>Class</strong> template. In the <strong>Name</strong> box, type <code>StreamReaderEnumerator.vb</code> and click <strong>OK</strong>.</td>\n</tr>\n</tbody>\n</table>\n<p> The first class in this project is the enumerable class and will implement the <code>IEnumerable(Of String)</code> interface. This generic interface implements the <a class=\"xref\" href=\"../../../../../api/system.collections.ienumerable\" data-linktype=\"relative-path\">IEnumerable</a> interface and guarantees that consumers of this class can access values typed as <code>String</code>.  </p>\n<table>\n<thead>\n<tr>\n<th>To add the code to implement IEnumerable</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.  Open the StreamReaderEnumerable.vb file.<br>2.  On the line after <code>Public Class StreamReaderEnumerable</code>, type the following and press ENTER.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#1\">    Implements IEnumerable(Of String)\n</code></pre><br>     Visual Basic automatically populates the class with the members that are required by the <code>IEnumerable(Of String)</code> interface.<br>3.  This enumerable class will read lines from a text file one line at a time. Add the following code to the class to expose a public constructor that takes a file path as an input parameter.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#2\">    Private _filePath As String\n\n    Public Sub New(ByVal filePath As String)\n        _filePath = filePath\n    End Sub\n</code></pre><br>4.  Your implementation of the <a class=\"xref\" href=\"../../../../../api/system.collections.generic.ienumerable-1#System_Collections_Generic_IEnumerable_1_GetEnumerator_\" data-linktype=\"relative-path\">GetEnumerator</a> method of the <code>IEnumerable(Of String)</code> interface will return a new instance of the <code>StreamReaderEnumerator</code> class. The implementation of the <code>GetEnumerator</code> method of the <code>IEnumerable</code> interface can be made <code>Private</code>, because you have to expose only members of the <code>IEnumerable(Of String)</code> interface. Replace the code that Visual Basic generated for the <code>GetEnumerator</code> methods with the following code.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#3\">    Public Function GetEnumerator() As IEnumerator(Of String) _\n        Implements IEnumerable(Of String).GetEnumerator\n\n        Return New StreamReaderEnumerator(_filePath)\n    End Function\n\n    Private Function GetEnumerator1() As IEnumerator _\n        Implements IEnumerable.GetEnumerator\n\n        Return Me.GetEnumerator()\n    End Function\n</code></pre></td>\n</tr>\n</tbody>\n</table>\n<table>\n<thead>\n<tr>\n<th>To add the code to implement IEnumerator</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1.  Open the StreamReaderEnumerator.vb file.<br>2.  On the line after <code>Public Class StreamReaderEnumerator</code>, type the following and press ENTER.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#4\">    Implements IEnumerator(Of String)\n</code></pre><br>     Visual Basic automatically populates the class with the members that are required by the <code>IEnumerator(Of String)</code> interface.<br>3.  The enumerator class opens the text file and performs the file I/O to read the lines from the file. Add the following code to the class to expose a public constructor that takes a file path as an input parameter and open the text file for reading.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#5\">    Private _sr As IO.StreamReader\n\n    Public Sub New(ByVal filePath As String)\n        _sr = New IO.StreamReader(filePath)\n    End Sub\n</code></pre><br>4.  The <code>Current</code> properties for both the <code>IEnumerator(Of String)</code> and <code>IEnumerator</code> interfaces return the current item from the text file as a <code>String</code>. The implementation of the <code>Current</code> property of the <code>IEnumerator</code> interface can be made <code>Private</code>, because you have to expose only members of the <code>IEnumerator(Of String)</code> interface. Replace the code that Visual Basic generated for the <code>Current</code> properties with the following code.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#6\">    Private _current As String\n\n    Public ReadOnly Property Current() As String _\n        Implements IEnumerator(Of String).Current\n\n        Get\n            If _sr Is Nothing OrElse _current Is Nothing Then\n                Throw New InvalidOperationException()\n            End If\n\n            Return _current\n        End Get\n    End Property\n\n    Private ReadOnly Property Current1() As Object _\n        Implements IEnumerator.Current\n\n        Get\n            Return Me.Current\n        End Get\n    End Property\n</code></pre><br>5.  The <code>MoveNext</code> method of the <code>IEnumerator</code> interface navigates to the next item in the text file and updates the value that is returned by the <code>Current</code> property. If there are no more items to read, the <code>MoveNext</code> method returns <code>False</code>; otherwise the <code>MoveNext</code> method returns <code>True</code>. Add the following code to the <code>MoveNext</code> method.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#7\">    Public Function MoveNext() As Boolean _\n        Implements System.Collections.IEnumerator.MoveNext\n\n        _current = _sr.ReadLine()\n        If _current Is Nothing Then Return False\n        Return True\n    End Function\n</code></pre><br>6.  The <code>Reset</code> method of the <code>IEnumerator</code> interface directs the iterator to point to the start of the text file and clears the current item value. Add the following code to the <code>Reset</code> method.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#8\">    Public Sub Reset() _\n        Implements System.Collections.IEnumerator.Reset\n\n        _sr.DiscardBufferedData()\n        _sr.BaseStream.Seek(0, IO.SeekOrigin.Begin)\n        _current = Nothing\n    End Sub\n</code></pre><br>7.  The <code>Dispose</code> method of the <code>IEnumerator</code> interface guarantees that all unmanaged resources are released before the iterator is destroyed. The file handle that is used by the <code>StreamReader</code> object is an unmanaged resource and must be closed before the iterator instance is destroyed. Replace the code that Visual Basic generated for the <code>Dispose</code> method with the following code.<br><pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#9\">    Private disposedValue As Boolean = False\n\n    Protected Overridable Sub Dispose(ByVal disposing As Boolean)\n        If Not Me.disposedValue Then\n            If disposing Then\n                &#39; Dispose of managed resources.\n            End If\n            _current = Nothing\n            _sr.Close()\n            _sr.Dispose()\n        End If\n\n        Me.disposedValue = True\n    End Sub\n\n    Public Sub Dispose() Implements IDisposable.Dispose\n        Dispose(True)\n        GC.SuppressFinalize(Me)\n    End Sub\n\n    Protected Overrides Sub Finalize()\n        Dispose(False)\n    End Sub\n</code></pre></td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"using-the-sample-iterator\">Using the Sample Iterator</h2>\n<p> You can use an enumerable class in your code together with control structures that require an object that implements <code>IEnumerable</code>, such as a <code>For Next</code> loop or a LINQ query. The following example shows the <code>StreamReaderEnumerable</code> in a LINQ query.  </p>\n<pre><code class=\"lang-vb\" name=\"VbVbalrIteratorWalkthrough#10\">        Dim adminRequests = \n            From line In New StreamReaderEnumerable(&quot;..\\..\\log.txt&quot;)\n            Where line.Contains(&quot;admin.aspx 401&quot;)\n\n        Dim results = adminRequests.ToList()\n</code></pre><h2 id=\"see-also\">See Also</h2>\n<p> <a href=\"../linq/introduction-to-linq\" data-linktype=\"relative-path\">Introduction to LINQ in Visual Basic</a><br> <a href=\"index\" data-linktype=\"relative-path\">Control Flow</a><br> <a href=\"loop-structures\" data-linktype=\"relative-path\">Loop Structures</a><br> <a href=\"../../../language-reference/statements/for-each-next-statement\" data-linktype=\"relative-path\">For Each...Next Statement</a></p>\n</div></div>","outputRootRelativePath":"../../../../../","pageMetadata":"<meta name=\"author\" content=\"stevehoag\">\r\n<meta name=\"ms.author\" content=\"shoag\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"/dotnet-all/api/toc2.json\">\r\n<meta name=\"ms.suite\" content=\"\">\r\n<meta name=\"ms.custom\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"c60d7589-51f2-4463-a2d5-22506bbc1554\">\r\n<meta name=\"translation.priority.ht\" content=\"cs-cz\">\r\n<meta name=\"translation.priority.ht\" content=\"de-de\">\r\n<meta name=\"translation.priority.ht\" content=\"es-es\">\r\n<meta name=\"translation.priority.ht\" content=\"fr-fr\">\r\n<meta name=\"translation.priority.ht\" content=\"it-it\">\r\n<meta name=\"translation.priority.ht\" content=\"ja-jp\">\r\n<meta name=\"translation.priority.ht\" content=\"ko-kr\">\r\n<meta name=\"translation.priority.ht\" content=\"pl-pl\">\r\n<meta name=\"translation.priority.ht\" content=\"pt-br\">\r\n<meta name=\"translation.priority.ht\" content=\"ru-ru\">\r\n<meta name=\"translation.priority.ht\" content=\"tr-tr\">\r\n<meta name=\"translation.priority.ht\" content=\"zh-cn\">\r\n<meta name=\"translation.priority.ht\" content=\"zh-tw\">\r\n<meta name=\"caps.latest.revision\" content=\"15\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"ms.date\" content=\"2015-07-20\">\r\n<meta name=\"ms.technology\" content=\"devlang-visual-basic\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"ms.reviewer\" content=\"\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2017-03-15 06:14 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/0a5d76c154aeb9b749c9c3fc5ad0962e93754a62/docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md\">\r\n<meta name=\"document_id\" content=\"2af86675-3060-bab9-ea74-4b810931c4cf\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"toc2.json\">\r\n","rawMetadata":{"author":"stevehoag","ms.author":"shoag","manager":"wpickett","breadcrumb_path":"/dotnet-internal/toc.json","title":"Implementing IEnumerable in Visual Basic | Microsoft Docs","ms.suite":"","ms.custom":"","ms.assetid":"c60d7589-51f2-4463-a2d5-22506bbc1554","translation.priority.ht":["cs-cz","de-de","es-es","fr-fr","it-it","ja-jp","ko-kr","pl-pl","pt-br","ru-ru","tr-tr","zh-cn","zh-tw"],"caps.latest.revision":15,"ms.topic":"article","dev_langs":["vb"],"helpviewer_keywords":["control flow [Visual Basic]","enumerable interfaces","loop structures, optimizing performance","control flow"],"ms.date":"2015-07-20","ms.technology":["devlang-visual-basic"],"ms.prod":".net","ms.reviewer":"","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Steve Hoag","author_email":"shoag@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Reorganizing the VB TOC (#1348)","commit_sha":"0a5d76c154aeb9b749c9c3fc5ad0962e93754a62","commit_date":"2017-02-14 10:22:48 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Petr Onderka","author_email":"gsvick@gmail.com","committer_name":"Maira Wenzel","comitter_email":"mairaw@microsoft.com","message":"Fixed included notes (#1275)","commit_sha":"eca9acb54f87a9c5d6ba0f632a222d43318e74c3","commit_date":"2016-11-19 17:12:50 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"Bill Wagner","comitter_email":"wiwagn@microsoft.com","message":":books: migration changes (#1235)","commit_sha":"b828bb1d6c8fb750ad9ef34f8a7a1b7d2574f4c6","commit_date":"2016-11-15 15:08:11 -0500"}],"updated_at":"2017-03-15 06:14 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag","id":"13489215"},"contributors":[{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"},{"profile_url":"https://github.com/svick","display_name":"Petr Onderka","id":"287848"}],"update_at":"3/15/2017"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/0a5d76c154aeb9b749c9c3fc5ad0962e93754a62/docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md","document_id":"2af86675-3060-bab9-ea74-4b810931c4cf","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/articles/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t","toc_asset_id":"articles/visual-basic/programming-guide/language-features/control-flow/toc.json","toc_rel":"toc.json","_op_ogTitle":"Implementing IEnumerable in Visual Basic","_op_displayDate":null,"_op_displayDate_source":null,"_op_wordCount":1211,"_op_rawTitle":"<h1 id=\"walkthrough-implementing-ienumerableof-t-in-visual-basic\" sourcefile=\"docs/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.md\" sourcestartlinenumber=\"39\" sourceendlinenumber=\"39\">Walkthrough: Implementing IEnumerable(Of T) in Visual Basic</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/articles/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t","fileRelativePath":"articles/visual-basic/programming-guide/language-features/control-flow/walkthrough-implementing-ienumerable-of-t.html"},"themesRelativePathToOutputRoot":"_themes/"}