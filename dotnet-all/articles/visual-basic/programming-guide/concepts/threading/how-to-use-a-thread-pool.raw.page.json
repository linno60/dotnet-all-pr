{"content":"<div><div class=\"content\">\n<p><em>Thread pooling</em> is a form of multithreading in which tasks are added to a queue and automatically started when threads are created. For more information, see <a href=\"thread-pooling\" data-linktype=\"relative-path\">Thread Pooling (Visual Basic)</a>.  </p>\n<p> The following example uses the .NET Framework thread pool to calculate the <code>Fibonacci</code> result for ten numbers between 20 and 40. Each <code>Fibonacci</code> result is represented by the <code>Fibonacci</code> class, which provides a method named <code>ThreadPoolCallback</code> that performs the calculation. An object that represents each <code>Fibonacci</code> value is created, and the <code>ThreadPoolCallback</code> method is passed to <a class=\"xref\" href=\"../../../../../api/system.threading.threadpool#System_Threading_ThreadPool_QueueUserWorkItem_\" data-linktype=\"relative-path\">QueueUserWorkItem</a>, which assigns an available thread in the pool to execute the method.  </p>\n<p> Because each <code>Fibonacci</code> object is given a semi-random value to compute, and because each thread will be competing for processor time, you cannot know in advance how long it will take for all ten results to be calculated. That is why each <code>Fibonacci</code> object is passed an instance of the <a class=\"xref\" href=\"../../../../../api/system.threading.manualresetevent\" data-linktype=\"relative-path\">ManualResetEvent</a> class during construction. Each object signals the provided event object when its calculation is complete, which allows the primary thread to block execution with <a class=\"xref\" href=\"../../../../../api/system.threading.waithandle#System_Threading_WaitHandle_WaitAll_\" data-linktype=\"relative-path\">WaitAll</a> until all ten <code>Fibonacci</code> objects have calculated a result. The <code>Main</code> method then displays each <code>Fibonacci</code> result.  </p>\n<h2 id=\"example\">Example</h2>\n<pre class=\"loading\"><code class=\"lang-vb\">Imports System.Threading  \n\nModule Module1  \n\n    Public Class Fibonacci  \n        Private _n As Integer  \n        Private _fibOfN  \n        Private _doneEvent As ManualResetEvent  \n\n        Public ReadOnly Property N() As Integer  \n            Get  \n                Return _n  \n            End Get  \n        End Property  \n\n        Public ReadOnly Property FibOfN() As Integer  \n            Get  \n                Return _fibOfN  \n            End Get  \n        End Property  \n\n        Sub New(ByVal n As Integer, ByVal doneEvent As ManualResetEvent)  \n            _n = n  \n            _doneEvent = doneEvent  \n        End Sub  \n\n        &#39; Wrapper method for use with the thread pool.  \n        Public Sub ThreadPoolCallBack(ByVal threadContext As Object)  \n            Dim threadIndex As Integer = CType(threadContext, Integer)  \n            Console.WriteLine(&quot;thread {0} started...&quot;, threadIndex)  \n            _fibOfN = Calculate(_n)  \n            Console.WriteLine(&quot;thread {0} result calculated...&quot;, threadIndex)  \n            _doneEvent.Set()  \n        End Sub  \n\n        Public Function Calculate(ByVal n As Integer) As Integer  \n            If n &lt;= 1 Then  \n                Return n  \n            End If  \n            Return Calculate(n - 1) + Calculate(n - 2)  \n        End Function  \n\n    End Class  \n\n    &lt;MTAThread()&gt;   \n    Sub Main()  \n        Const FibonacciCalculations As Integer = 9 &#39; 0 to 9  \n\n        &#39; One event is used for each Fibonacci object  \n        Dim doneEvents(FibonacciCalculations) As ManualResetEvent  \n        Dim fibArray(FibonacciCalculations) As Fibonacci  \n        Dim r As New Random()  \n\n        &#39; Configure and start threads using ThreadPool.  \n        Console.WriteLine(&quot;launching {0} tasks...&quot;, FibonacciCalculations)  \n\n        For i As Integer = 0 To FibonacciCalculations  \n            doneEvents(i) = New ManualResetEvent(False)  \n            Dim f = New Fibonacci(r.Next(20, 40), doneEvents(i))  \n            fibArray(i) = f  \n            ThreadPool.QueueUserWorkItem(AddressOf f.ThreadPoolCallBack, i)  \n        Next  \n\n        &#39; Wait for all threads in pool to calculate.  \n        WaitHandle.WaitAll(doneEvents)  \n        Console.WriteLine(&quot;All calculations are complete.&quot;)  \n\n        &#39; Display the results.  \n        For i As Integer = 0 To FibonacciCalculations  \n            Dim f As Fibonacci = fibArray(i)  \n            Console.WriteLine(&quot;Fibonacci({0}) = {1}&quot;, f.N, f.FibOfN)  \n        Next  \n    End Sub  \n\nEnd Module  \n</code></pre><p> Following is an example of the output.  </p>\n<pre class=\"loading\"><code>launching 10 tasks...  \nthread 0 started...  \nthread 1 started...  \nthread 1 result calculated...  \nthread 2 started...  \nthread 2 result calculated...  \nthread 3 started...  \nthread 3 result calculated...  \nthread 4 started...  \nthread 0 result calculated...  \nthread 5 started...  \nthread 5 result calculated...  \nthread 6 started...  \nthread 4 result calculated...  \nthread 7 started...  \nthread 6 result calculated...  \nthread 8 started...  \nthread 8 result calculated...  \nthread 9 started...  \nthread 9 result calculated...  \nthread 7 result calculated...  \nAll calculations are complete.  \nFibonacci(38) = 39088169  \nFibonacci(29) = 514229  \nFibonacci(25) = 75025  \nFibonacci(22) = 17711  \nFibonacci(38) = 39088169  \nFibonacci(29) = 514229  \nFibonacci(29) = 514229  \nFibonacci(38) = 39088169  \nFibonacci(21) = 10946  \nFibonacci(27) = 196418  \n</code></pre><h2 id=\"see-also\">See Also</h2>\n<p> <a class=\"xref\" href=\"../../../../../api/system.threading.mutex\" data-linktype=\"relative-path\">Mutex</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.waithandle#System_Threading_WaitHandle_WaitAll_\" data-linktype=\"relative-path\">WaitAll</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.manualresetevent\" data-linktype=\"relative-path\">ManualResetEvent</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.eventwaithandle#System_Threading_EventWaitHandle_Set_\" data-linktype=\"relative-path\">Set</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.threadpool\" data-linktype=\"relative-path\">ThreadPool</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.threadpool#System_Threading_ThreadPool_QueueUserWorkItem_\" data-linktype=\"relative-path\">QueueUserWorkItem</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.manualresetevent\" data-linktype=\"relative-path\">ManualResetEvent</a><br> <a href=\"thread-pooling\" data-linktype=\"relative-path\">Thread Pooling (Visual Basic)</a><br> <a href=\"index\" data-linktype=\"relative-path\">Threading (Visual Basic)</a><br> <a class=\"xref\" href=\"../../../../../api/system.threading.monitor\" data-linktype=\"relative-path\">Monitor</a><br> <a href=\"http://msdn.microsoft.com/library/9a9621d7-8883-4a4f-a874-65e8e09e20a6\" data-linktype=\"external\">Security</a></p>\n</div></div>","outputRootRelativePath":"../../../../../","pageMetadata":"<meta name=\"author\" content=\"stevehoag\">\r\n<meta name=\"ms.author\" content=\"shoag\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"apiPlatform\" content=\"dotnet\">\r\n<meta name=\"ms.suite\" content=\"\">\r\n<meta name=\"ms.custom\" content=\"\">\r\n<meta name=\"ms.tgt_pltfrm\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"90a0bb24-39f8-41f5-a217-b52a7d4fed0b\">\r\n<meta name=\"caps.latest.revision\" content=\"3\">\r\n<meta name=\"ms.topic\" content=\"article\">\r\n<meta name=\"translation.priority.mt\" content=\"cs-cz\">\r\n<meta name=\"translation.priority.mt\" content=\"pl-pl\">\r\n<meta name=\"translation.priority.mt\" content=\"pt-br\">\r\n<meta name=\"translation.priority.mt\" content=\"tr-tr\">\r\n<meta name=\"ms.date\" content=\"2015-07-20\">\r\n<meta name=\"ms.technology\" content=\"devlang-visual-basic\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"ms.reviewer\" content=\"\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"updated_at\" content=\"2016-12-15 06:00 PM\">\r\n<meta name=\"gitcommit\" content=\"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md\">\r\n<meta name=\"original_content_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md\">\r\n<meta name=\"document_id\" content=\"9fe2e1f9-dc0c-9f07-833d-adcfb9c3e9ba\">\r\n<meta name=\"pagetype\" content=\"Conceptual\">\r\n<meta name=\"toc_rel\" content=\"toc2.json\">\r\n","rawMetadata":{"author":"stevehoag","ms.author":"shoag","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","apiPlatform":"dotnet","title":"How to: Use a Thread Pool (Visual Basic) | Microsoft Docs","ms.suite":"","ms.custom":"","ms.tgt_pltfrm":"","ms.assetid":"90a0bb24-39f8-41f5-a217-b52a7d4fed0b","caps.latest.revision":3,"ms.topic":"article","dev_langs":["vb"],"translation.priority.mt":["cs-cz","pl-pl","pt-br","tr-tr"],"ms.date":"2015-07-20","ms.technology":["devlang-visual-basic"],"ms.prod":".net","ms.reviewer":"","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitCommitHistory":[{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"GitHub","comitter_email":"noreply@github.com","message":"Metadata updates (#1313)","commit_sha":"90fe68f7f3c4b46502b5d3770b1a2d57c6af748a","commit_date":"2016-12-09 12:40:41 -0800"},{"author_name":"Maira Wenzel","author_email":"mairaw@microsoft.com","committer_name":"Bill Wagner","comitter_email":"wiwagn@microsoft.com","message":":books: migration changes (#1235)","commit_sha":"b828bb1d6c8fb750ad9ef34f8a7a1b7d2574f4c6","commit_date":"2016-11-15 15:08:11 -0500"}],"updated_at":"2016-12-15 06:00 PM","_op_gitContributorInformation":{"author":{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag","id":"13489215"},"contributors":[{"profile_url":"https://github.com/stevehoag","display_name":"Steve Hoag"},{"profile_url":"https://github.com/mairaw","display_name":"Maira Wenzel","id":"12971179"}],"update_at":"12/15/2016"},"gitcommit":"https://github.com/dotnet/docs-internal/blob/90fe68f7f3c4b46502b5d3770b1a2d57c6af748a/docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md","original_content_git_url":"https://github.com/dotnet/docs-internal/blob/master/docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md","open_to_public_contributors":false,"content_git_url":"https://github.com/dotnet/docs/blob/master/docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md","document_id":"9fe2e1f9-dc0c-9f07-833d-adcfb9c3e9ba","layout":"Conceptual","pagetype":"Conceptual","canonical_url":"https://docs.microsoft.com/en-us/dotnet/articles/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool","toc_asset_id":"articles/visual-basic/programming-guide/concepts/threading/toc.json","toc_rel":"toc.json","_op_ogTitle":"How to: Use a Thread Pool (Visual Basic)","_op_displayDate":null,"_op_displayDate_source":null,"_op_wordCount":554,"_op_rawTitle":"<h1 id=\"how-to-use-a-thread-pool-visual-basic\" sourcefile=\"docs/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.md\" sourcestartlinenumber=\"25\" sourceendlinenumber=\"25\">How to: Use a Thread Pool (Visual Basic)</h1>","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/articles/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool","fileRelativePath":"articles/visual-basic/programming-guide/concepts/threading/how-to-use-a-thread-pool.html"},"themesRelativePathToOutputRoot":"_themes/"}