{"content":"\r\n  \r\n  <h1>\r\n    <span class=\"lang-csharp\">CriticalHandle</span>\r\n    \t\t\t\tClass\r\n  </h1>\r\n  \r\n  <h2 class=\"hiddenAnchor\">Definition</h2>\r\n  \r\n  <div class=\"metadata\">\r\n  \r\n  \r\n  </div>\r\n  \r\n  <div class=\"summaryHolder\">\r\n  \t<div class=\"summary\">\r\n  \t\t<p>Represents a wrapper class for handle resources.</p>\n\r\n  \t</div>\r\n  </div><nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n    <h3>In this Article</h3>\r\n  </nav>\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\">[System.Security.SecurityCritical]\npublic abstract class CriticalHandle : System.Runtime.ConstrainedExecution.CriticalFinalizerObject, IDisposable</code></pre>\r\n  \r\n  \r\n  \r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Inheritance</dt><dd>\r\n  \t\t<div class=\"pdlHolder\">\r\n  \t\t<div class=\"pdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a></span></div><div class=\"pdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.runtime.constrainedexecution.criticalfinalizerobject\" data-linktype=\"relative-path\">System.Runtime.ConstrainedExecution.CriticalFinalizerObject</a></span></div><span class=\"lang-csharp\">CriticalHandle</span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \r\n  \r\n  \r\n  \t<h3 class=\"accented\">Inherited Members</h3>\r\n  \t<h4 class=\"accented\"></h4>\r\n  \t<div class=\"cdlHolder\">\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_\" data-linktype=\"relative-path\">Equals(Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_System_Object_\" data-linktype=\"relative-path\">Equals(Object,Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetHashCode\" data-linktype=\"relative-path\">GetHashCode()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetType\" data-linktype=\"relative-path\">GetType()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_MemberwiseClone\" data-linktype=\"relative-path\">MemberwiseClone()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ReferenceEquals_System_Object_System_Object_\" data-linktype=\"relative-path\">ReferenceEquals(Object,Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ToString\" data-linktype=\"relative-path\">ToString()</a></span></div>\r\n  \t</div>\r\n  \r\n  \t<h2 class=\"accented\">Remarks</h2>\r\n  \t<p>The CriticalHandle class is similar to the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class, except that <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> implements reference counting. You can use CriticalHandle instead of <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> to address performance considerations when you can provide the necessary synchronization more efficiently yourself.  </p>\n<p> Because the CriticalHandle class does not perform reference counting, it does not provide protection from handle recycling security attacks. Because the reference counting algorithm implicitly serializes operations, a certain amount of thread safety is also lost. If you call the <a class=\"xref\" href=\"system.idisposable#System_IDisposable_Dispose_\" data-linktype=\"relative-path\">Dispose</a> or <a class=\"xref\" href=\"system.runtime.interopservices.safehandle#System_Runtime_InteropServices_SafeHandle_Close_\" data-linktype=\"relative-path\">Close</a> method while an operation that is using the handle is outstanding on another thread, or if you call <a class=\"xref\" href=\"system.idisposable#System_IDisposable_Dispose_\" data-linktype=\"relative-path\">Dispose</a> or <a class=\"xref\" href=\"system.runtime.interopservices.safehandle#System_Runtime_InteropServices_SafeHandle_Close_\" data-linktype=\"relative-path\">Close</a> from two threads at the same time, the results are non-deterministic. The CriticalHandle class still provides the guaranteed critical finalization provided by the <a class=\"xref\" href=\"system.runtime.constrainedexecution.criticalfinalizerobject\" data-linktype=\"relative-path\">CriticalFinalizerObject</a> class.</p>\n\r\n  \r\n  \r\n  \t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Constructors\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle__ctor_System_IntPtr_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">CriticalHandle(IntPtr)</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Initializes a new instance of the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> class with the specified invalid handle value.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected CriticalHandle (IntPtr invalidHandleValue);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>invalidHandleValue</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.intptr\" data-linktype=\"relative-path\">IntPtr</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p>The value of an invalid handle (usually 0 or -1).</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Exceptions</div>\r\n  \t\t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t\t<div class=\"subtle\">\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.typeloadexception\" data-linktype=\"relative-path\">TypeLoadException</a></span>\r\n  \t\t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t\t<p>The derived class resides in an assembly without unmanaged code access permission.</p>\n\r\n  \t\t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t  \r\n  \t\t</section>\t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Fields\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_handle\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">handle</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Specifies the handle to be wrapped.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected IntPtr handle;</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Do not expose the handle publicly (that is, outside of the derived class).</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t  \r\n  \t\t</section>\t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Properties\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_IsClosed\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">IsClosed</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Gets a value indicating whether the handle is closed.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public bool IsClosed { get; }</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Value</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.boolean\" data-linktype=\"relative-path\">Boolean</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p><code>true</code> if the handle is closed; otherwise, <code>false</code>.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>The IsClosed method returns a value indicating whether the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object&#39;s handle is no longer associated with a native resource. This differs from the definition of the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_IsInvalid_\" data-linktype=\"relative-path\">IsInvalid</a> property, which computes whether a given handle is always considered invalid. The IsClosed method returns a <code>true</code> value in the following cases:  </p>\n<ul>\n<li><p>The <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_SetHandleAsInvalid_\" data-linktype=\"relative-path\">SetHandleAsInvalid</a> method was called.  </p>\n</li>\n<li><p>The <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Dispose_\" data-linktype=\"relative-path\">Dispose</a> method or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> method was called and there are no references to the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object on other threads.</p>\n</li>\n</ul>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_IsInvalid\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">IsInvalid</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>When overridden in a derived class, gets a value indicating whether the handle value is invalid.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public abstract bool IsInvalid { get; }</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Value</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.boolean\" data-linktype=\"relative-path\">Boolean</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p><code>true</code> if the handle is valid; otherwise, <code>false</code>.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Derived classes must implement the IsInvalid property so that the common language runtime can determine whether critical finalization is required. Derived classes must provide an implementation that suits the general type of handle they support (0 or -1 is invalid). These classes can then be further derived for specific safe handle types.  </p>\n<p> Unlike the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_IsClosed_\" data-linktype=\"relative-path\">IsClosed</a> property, which reports whether the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object has finished using the underlying handle, the IsInvalid property calculates whether the given handle value is always considered invalid. Therefore, the IsInvalid property always returns the same value for any one handle value.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t  \r\n  \t\t</section>\t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Methods\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_Close\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Close()</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Marks the handle for releasing and freeing resources.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public void Close ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Calling the Close or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Dispose_\" data-linktype=\"relative-path\">Dispose</a> method allows the resources to be freed. Unlike the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class, this will always happen immediately since there is no reference count to indicate that other threads are using this handle. Therefore, you must employ a synchronization mechanism to ensure it is safe to call the Close method. Although most classes that use the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> class do not need to provide a finalizer, this is sometimes necessary (for example, to flush out file buffers or to write some data back into memory). In this case, the class can provide a finalizer that is guaranteed to run before the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> critical finalizer runs.  </p>\n<p> Call the Close or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Dispose_\" data-linktype=\"relative-path\">Dispose</a> method when you are finished using the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object. The Close method leaves the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object in an unusable state.  </p>\n<p> <strong>Note</strong> Always call Close or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Dispose_\" data-linktype=\"relative-path\">Dispose</a> before you release your last reference to the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object. Otherwise, the resources it is using will not be freed until the garbage collector calls the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object&#39;s <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Finalize_\" data-linktype=\"relative-path\">Finalize</a> method.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_Dispose\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Dispose()</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Releases all resources used by the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a>.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public void Dispose ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Calling the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> or Dispose method allows the resources to be freed. Unlike the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class, this will always happen immediately since there is no reference count to indicate that other threads are using this handle. Therefore, you must employ a synchronization mechanism to ensure it is safe to call the Dispose method. Although most classes that use the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> class do not need to provide a finalizer, this is sometimes necessary (for example, to flush out file buffers or to write some data back into memory). In this case, the class can provide a finalizer that is guaranteed to run before the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> critical finalizer runs.  </p>\n<p> Call the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> or Dispose method when you are finished using the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object. The <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> method leaves the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object in an unusable state.  </p>\n<p> <strong>Note</strong> Always call the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> or Dispose method before you release your last reference to the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object. Otherwise, the resources it is using will not be freed until the garbage collector calls the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> object&#39;s <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Finalize_\" data-linktype=\"relative-path\">Finalize</a> method.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_Dispose_System_Boolean_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Dispose(Boolean)</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Releases the unmanaged resources used by the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> class specifying whether to perform a normal dispose operation.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected virtual void Dispose (bool disposing);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>disposing</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.boolean\" data-linktype=\"relative-path\">Boolean</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p><code>true</code> for a normal dispose operation; <code>false</code> to finalize the handle.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>You should never explicitly call the Dispose method with the <code>disposing</code> parameter set to <code>false</code>.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_Finalize\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Finalize()</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Frees all resources associated with the handle.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">~CriticalHandle ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>The Finalize method is the destructor for the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> class. Application code should not call this method directly.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_ReleaseHandle\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">ReleaseHandle()</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>When overridden in a derived class, executes the code required to free the handle.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected abstract bool ReleaseHandle ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Returns</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.boolean\" data-linktype=\"relative-path\">Boolean</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p><code>true</code> if the handle is released successfully; otherwise, in the event of a catastrophic failure,<code>false</code>. In this case, it generates a <a href=\"../topic/releasehandlefailed%20mda\" data-linktype=\"relative-path\">releaseHandleFailed</a> Managed Debugging Assistant.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>The ReleaseHandle method is guaranteed to be called only once, provided that you employ proper synchronization mechanisms to ensure that only one call to the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Close_\" data-linktype=\"relative-path\">Close</a> or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_Dispose_\" data-linktype=\"relative-path\">Dispose</a> method is made. The ReleaseHandle method will not be called if the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_IsInvalid_\" data-linktype=\"relative-path\">IsInvalid</a> or <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_IsClosed_\" data-linktype=\"relative-path\">IsClosed</a> property is <code>true</code>. Implement this method in your <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> derived classes to execute any code that is required to free the handle. Because one of the functions of <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a> is to guarantee prevention of resource leaks, the code in your implementation of ReleaseHandle must never fail. The garbage collector calls ReleaseHandle after normal finalizers have been run for objects that were garbage collected at the same time, and guarantees the resources to invoke it and that it will not be interrupted while it is in progress. This method will be prepared as a constrained execution region (CER) at instance construction time (along with all the methods in its statically determinable call graph). Although this prevents thread abort interrupts, you must still be careful not to introduce any fault paths in your overridden ReleaseHandle method. In particular, apply the <a class=\"xref\" href=\"system.runtime.constrainedexecution.reliabilitycontractattribute\" data-linktype=\"relative-path\">ReliabilityContractAttribute</a> attribute to any methods you call from ReleaseHandle. In most cases this code should be:  </p>\n<p> <code>ReliabilityContract(Consistency.WillNotCorruptState, Cer.Success)</code>  </p>\n<p> Additionally, for simple cleanup (for example, calling the Win32 API <code>CloseHandle</code> on a file handle) you can check the return value for the single platform invoke call. For complex cleanup, you may have a lot of program logic and many method calls, some of which might fail. You must ensure that your program logic has fallback code for each of those cases.  </p>\n<p> If the ReleaseHandle method returns <code>false</code> for any reason, it generates a <a href=\"../topic/releasehandlefailed%20mda\" data-linktype=\"relative-path\">releaseHandleFailed</a> Managed Debugging Assistant.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_SetHandle_System_IntPtr_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">SetHandle(IntPtr)</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Sets the handle to the specified pre-existing handle.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected void SetHandle (IntPtr handle);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>handle</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.intptr\" data-linktype=\"relative-path\">IntPtr</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p>The pre-existing handle to use.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Use the SetHandle method only if you need to support a pre-existing handle (for example, if the handle is returned in a structure) because the .NET Framework COM interop infrastructure does not support marshaling handles in a structure.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_CriticalHandle_SetHandleAsInvalid\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">SetHandleAsInvalid()</span>        \r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Marks a handle as invalid.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public void SetHandleAsInvalid ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>Call the SetHandleAsInvalid method only when you know that your handle is invalid and you want to mark it as such. Doing so does not change the value of the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_handle\" data-linktype=\"relative-path\">handle</a> field; it only marks the handle as invalid. The handle might then contain a potentially stale value. The effect of this call is that no attempt is made to free the resources.  </p>\n<p> As with the <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle#System_Runtime_InteropServices_CriticalHandle_SetHandle_\" data-linktype=\"relative-path\">SetHandle</a> method, use SetHandleAsInvalid only if you need to support a pre-existing handle.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t  \r\n  \t\t</section>\r\n  \r\n  \r\n","outputRootRelativePath":"../","pageMetadata":"<meta name=\"author\" content=\"dotnet-bot\">\r\n<meta name=\"ms.author\" content=\"dotnetcontent\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"toc2.json\">\r\n<meta name=\"ms.topic\" content=\"managed-reference\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.InteropServices.CriticalHandle.yml\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle..ctor\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.Close\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.Dispose\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.Finalize\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.handle\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.IsClosed\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.IsInvalid\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.ReleaseHandle\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.SetHandle\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.CriticalHandle.SetHandleAsInvalid\">\r\n<meta name=\"APILocation\" content=\"mscorlib.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2017-03-23 06:04 AM\">\r\n<meta name=\"document_id\" content=\"69e01c50-031f-1488-9d35-964b6233cbae\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"Represents a wrapper class for handle resources.\n\">\r\n<meta name=\"toc_rel\" content=\"_splitted/system.runtime.interopservices/toc2.json\">\r\n<meta name=\"source_url\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"System.Runtime.InteropServices.CriticalHandle\">\r\n","rawMetadata":{"author":"dotnet-bot","ms.author":"dotnetcontent","manager":"wpickett","breadcrumb_path":"/dotnet-internal/toc.json","ms.topic":"managed-reference","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitRefSkeletonCommitHistory":[],"original_ref_skeleton_git_url":"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.InteropServices.CriticalHandle.yml","open_to_public_contributors":false,"api_name":["System.Runtime.InteropServices.CriticalHandle","System.Runtime.InteropServices.CriticalHandle..ctor","System.Runtime.InteropServices.CriticalHandle.Close","System.Runtime.InteropServices.CriticalHandle.Dispose","System.Runtime.InteropServices.CriticalHandle.Finalize","System.Runtime.InteropServices.CriticalHandle.handle","System.Runtime.InteropServices.CriticalHandle.IsClosed","System.Runtime.InteropServices.CriticalHandle.IsInvalid","System.Runtime.InteropServices.CriticalHandle.ReleaseHandle","System.Runtime.InteropServices.CriticalHandle.SetHandle","System.Runtime.InteropServices.CriticalHandle.SetHandleAsInvalid"],"api_location":["mscorlib.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.Runtime.InteropServices.CriticalHandle","System::Runtime::InteropServices::CriticalHandle","System.Runtime.InteropServices.CriticalHandle.#ctor","System::Runtime::InteropServices::CriticalHandle::#ctor","System.Runtime.InteropServices.CriticalHandle.Close","System::Runtime::InteropServices::CriticalHandle::Close","System.Runtime.InteropServices.CriticalHandle.Dispose","System::Runtime::InteropServices::CriticalHandle::Dispose","System.Runtime.InteropServices.CriticalHandle.Finalize","System::Runtime::InteropServices::CriticalHandle::Finalize","System.Runtime.InteropServices.CriticalHandle.handle","System::Runtime::InteropServices::CriticalHandle::handle","System.Runtime.InteropServices.CriticalHandle.IsClosed","System::Runtime::InteropServices::CriticalHandle::IsClosed","System.Runtime.InteropServices.CriticalHandle.IsInvalid","System::Runtime::InteropServices::CriticalHandle::IsInvalid","System.Runtime.InteropServices.CriticalHandle.ReleaseHandle","System::Runtime::InteropServices::CriticalHandle::ReleaseHandle","System.Runtime.InteropServices.CriticalHandle.SetHandle","System::Runtime::InteropServices::CriticalHandle::SetHandle","System.Runtime.InteropServices.CriticalHandle.SetHandleAsInvalid","System::Runtime::InteropServices::CriticalHandle::SetHandleAsInvalid"],"dev_langs":["csharp"],"updated_at":"2017-03-23 06:04 AM","document_id":"69e01c50-031f-1488-9d35-964b6233cbae","content_git_url":"https://github.com/TianqiZhang/ECMA2YamlTestRepo2/blob/master/xml/System.Runtime.InteropServices/CriticalHandle.xml","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"CriticalHandle class | Microsoft Docs","_op_ogTitle":"CriticalHandle class","description":"Represents a wrapper class for handle resources.\n","toc_asset_id":"api/_splitted/System.Runtime.InteropServices/toc.json","toc_rel":"_splitted/System.Runtime.InteropServices/toc.json","source_url":"","ms.assetid":"System.Runtime.InteropServices.CriticalHandle","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/api/system.runtime.interopservices.criticalhandle","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/api/system.runtime.interopservices.criticalhandle","fileRelativePath":"api/System.Runtime.InteropServices.CriticalHandle.html"},"themesRelativePathToOutputRoot":"_themes/"}