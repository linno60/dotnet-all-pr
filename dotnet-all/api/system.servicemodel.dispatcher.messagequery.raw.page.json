{"content":"\r\n  \r\n  <h1>\r\n    <span class=\"lang-csharp\">MessageQuery</span>\r\n    \t\t\t\tClass\r\n  </h1>\r\n  \r\n  <h2 class=\"hiddenAnchor\">Definition</h2>\r\n  \r\n  <div class=\"metadata\">\r\n  \r\n  \r\n  </div>\r\n  \r\n  <div class=\"summaryHolder\">\r\n  \t<div class=\"summary\">\r\n  \t\t<p>Defines the core behavior of classes used to search for specific correlating data in a message.</p>\n\r\n  \t</div>\r\n  </div><nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n    <h3>In this Article</h3>\r\n  </nav>\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\">public abstract class MessageQuery</code></pre>\r\n  \r\n  \r\n  \r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Inheritance</dt><dd>\r\n  \t\t<div class=\"pdlHolder\">\r\n  \t\t<div class=\"pdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a></span></div><span class=\"lang-csharp\">MessageQuery</span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Derived</dt><dd>\r\n  \t\t<div class=\"cdlHolder\">\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.servicemodel.xpathmessagequery\" data-linktype=\"relative-path\">XPathMessageQuery</a></span></div>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \r\n  \r\n  \t<h3 class=\"accented\">Inherited Members</h3>\r\n  \t<h4 class=\"accented\"></h4>\r\n  \t<div class=\"cdlHolder\">\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_\" data-linktype=\"relative-path\">Equals(Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_System_Object_\" data-linktype=\"relative-path\">Equals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetHashCode\" data-linktype=\"relative-path\">GetHashCode()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetType\" data-linktype=\"relative-path\">GetType()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_MemberwiseClone\" data-linktype=\"relative-path\">MemberwiseClone()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ReferenceEquals_System_Object_System_Object_\" data-linktype=\"relative-path\">ReferenceEquals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ToString\" data-linktype=\"relative-path\">ToString()</a></span></div>\r\n  \t</div>\r\n  \r\n  \t<h2 class=\"accented\">Examples</h2>\r\n  \t<p>The following example creates a message and XPath message queries. The queries are evaluated by the <a class=\"xref\" href=\"system.servicemodel.xpathmessagequery\" data-linktype=\"relative-path\">XPathMessageQuery</a> objects contained in an <a class=\"xref\" href=\"system.servicemodel.dispatcher.xpathmessagequerycollection\" data-linktype=\"relative-path\">XPathMessageQueryCollection</a> object. The results of each query are tested using the <a class=\"xref\" href=\"system.servicemodel.dispatcher.xpathresult#System_ServiceModel_Dispatcher_XPathResult_ResultType_\" data-linktype=\"relative-path\">ResultType</a> property of the <a class=\"xref\" href=\"system.servicemodel.dispatcher.xpathresult\" data-linktype=\"relative-path\">XPathResult</a> class.  </p>\n<pre><code class=\"lang-vb\" name=\"XPathMessageQuery#0\">Imports System.IO\nImports System.Xml\nImports System.ServiceModel.Dispatcher\nImports System.ServiceModel\nImports System.ServiceModel.Channels\nImports System.Xml.XPath\n\nNamespace MessageQueryExamples\n\n\n    Public Class Program\n\n        Public Shared Sub Main(ByVal args As String())\n\n            &#39; The XPathMessageQueryCollection inherits from MessageQueryCollection.\n            Dim queryCollection As XPathMessageQueryCollection = MessageHelper.SetupQueryCollection()\n\n\n            &#39; Create a message and a copy of the message. You must create a buffered copy to access the message body.\n            Dim mess As Message = MessageHelper.CreateMessage()\n            Dim mb As MessageBuffer = mess.CreateBufferedCopy(Integer.MaxValue)\n\n\n            &#39; Evaluate every query in the collection. \n            Dim q As XPathMessageQuery\n            For Each q In queryCollection\n\n                &#39; Evaluate the query. Note the result type is an XPathResult.\n                Dim qPathResult As XPathResult = q.Evaluate(Of XPathResult)(mb)\n\n                &#39; Use the XPathResult to determine the result type.\n                Console.WriteLine(&quot;Result type: {0}&quot;, qPathResult.ResultType)\n\n                &#39; The following code prints the result according to the result type.\n\n                If qPathResult.ResultType = XPathResultType.String Then\n                    Console.WriteLine(&quot;{0} = {1}&quot;, q.Expression, qPathResult.GetResultAsString())\n                End If\n                If (qPathResult.ResultType = XPathResultType.NodeSet) Then\n\n                    &#39; Iterate through the node set.\n                    Dim ns As XPathNodeIterator = qPathResult.GetResultAsNodeset()\n                    Dim n As XPathNavigator\n                    For Each n In ns\n                        Console.WriteLine(&quot;     {0} = {1}&quot;, q.Expression, n.Value)\n                    Next\n                End If\n                If qPathResult.ResultType = XPathResultType.Number Then\n                    Console.WriteLine(&quot;    {0} = {1}&quot;, q.Expression, qPathResult.GetResultAsNumber())\n                End If\n                If qPathResult.ResultType = XPathResultType.Boolean Then\n                    Console.WriteLine(&quot;    {0} ={1}&quot;, q.Expression, qPathResult.GetResultAsBoolean())\n                End If\n\n                If qPathResult.ResultType = XPathResultType.Error Then\n                    Console.WriteLine(&quot;    Error!&quot;)\n                End If\n\n            Next\n\n            Console.WriteLine()\n\n            &#39; The alternate code below demonstrates similar funcionality using a MessageQueryTable.\n            &#39; The difference is the KeyValuePair that requires a key to index each value.\n            &#39; The code uses the expression as the key, and an arbitrary value for the value.           \n\n            &#39;Dim mq As MessageQueryTable(Of String) = MessageHelper.SetupTable()\n            &#39;Dim kv As KeyValuePair(Of MessageQuery, String)\n            &#39;For Each kv In mq\n            &#39;    &#39;\n            &#39;    Dim xp As XPathMessageQuery = CType(kv.Key, XPathMessageQuery)\n            &#39;    Console.WriteLine(&quot;Value = {0}&quot;, kv.Value)\n            &#39;    Console.WriteLine(&quot;{0} = {1}&quot;, xp.Expression, xp.Evaluate(Of String)(mb))\n            &#39;Next\n\n            Console.ReadLine()\n        End Sub\n        Private Shared Sub Evaluate(ByVal p1 As Object)\n            Throw New NotImplementedException\n        End Sub\n    End Class\n\n    Public Class MessageHelper\n\n        Shared messageBody As String = _\n              &quot;&lt;PurchaseOrder date=&#39;today&#39;&gt;&quot; + _\n                  &quot;&lt;Number&gt;ABC-2009-XYZ&lt;/Number&gt;&quot; + _\n                  &quot;&lt;Department&gt;OnlineSales&lt;/Department&gt;&quot; + _\n                  &quot;&lt;Items&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;nail&#39; quantity=&#39;1&#39;&gt;item1&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;screw&#39; quantity=&#39;2&#39;&gt;item2&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;brad&#39; quantity=&#39;3&#39;&gt;&quot; + _\n                          &quot;&lt;SpecialOffer/&gt;&quot; + _\n                          &quot;Special item4&quot; + _\n                      &quot;&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;SpecialNails&#39; quantity=&#39;9&#39;&gt;item5&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;SpecialBrads&#39; quantity=&#39;11&#39;&gt;&quot; + _\n                          &quot;&lt;SpecialOffer/&gt;&quot; + _\n                          &quot;Special item6&quot; + _\n                      &quot;&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;hammer&#39; quantity=&#39;1&#39;&gt;item7&lt;/Item&gt;&quot; + _\n                      &quot;&lt;Item product=&#39;wrench&#39; quantity=&#39;2&#39;&gt;item8&lt;/Item&gt;&quot; + _\n                  &quot;&lt;/Items&gt;&quot; + _\n                &quot;&lt;Comments&gt;&quot; + _\n                &quot;Rush order&quot; + _\n                &quot;&lt;/Comments&gt;&quot; + _\n              &quot;&lt;/PurchaseOrder&gt;&quot;\n\n        Public Shared xpath As String = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@quantity = 1]&quot;\n        Public Shared xpath2 As String = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@product = &#39;nail&#39;]&quot;\n        Public Shared xpath3 As String = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Comments&quot;\n        Public Shared xpath4 As String = &quot;count(/s12:Envelope/s12:Body/PurchaseOrder/Items/Item)&quot;\n        Public Shared xpath5 As String = &quot;substring(string(/s12:Envelope/s12:Body/PurchaseOrder/Number),5,4)&quot;\n        Public Shared xpath6 As String = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Department=&#39;OnlineSales&#39;&quot;\n        Public Shared xpath7 As String = &quot;//PurchaseOrder/@date&quot;\n        Public Shared xpath8 As String = &quot;//SpecialOffer/ancestor::Item[@product = &#39;brad&#39;]&quot;\n\n        &#39; Invoke the correlation data function.\n\n\n        Public Shared xpath9 As String = &quot;sm:correlation-data(&#39;CorrelationData1&#39;)&quot;\n        Public Shared xpath10 As String = &quot;sm:correlation-data(&#39;CorrelationData2&#39;)&quot;\n\n        Public Shared xpath11 As String = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@quantity = 2]&quot;\n\n\n        Public Shared Function CreateMessage() As Message\n\n            Dim stringReader As New StringReader(messageBody)\n            Dim xmlReader As New XmlTextReader(stringReader)\n            Dim message As Message = message.CreateMessage( _\n                MessageVersion.Soap12WSAddressing10, &quot;http://purchaseorder&quot;, xmlReader)\n\n            &#39; Add two correlation properties using lambda expressions. The property names are\n            &#39; CorrelationData1 and CorrelationData2. The first goes to &quot;value1&quot; and the\n            &#39; second to &quot;value2&quot;. You can use your own property names and values.\n            Dim data As New CorrelationDataMessageProperty()\n\n            data.Add(&quot;CorrelationData1&quot;, Function() &quot;value1&quot;)\n            data.Add(&quot;CorrelationData2&quot;, Function() &quot;value2&quot;)\n            message.Properties(CorrelationDataMessageProperty.Name) = data\n\n\n            Return message\n        End Function\n\n\n        Public Shared Function SetupQueryCollection() As XPathMessageQueryCollection\n\n            &#39; Create the query collection and add the XPath queries to it. To create\n            &#39; the query, you must also use a new XPathMessageContext.\n\n            Dim queryCollection As New XPathMessageQueryCollection()\n\n            Dim context As XPathMessageContext = New XPathMessageContext()\n            queryCollection.Add(New XPathMessageQuery(xpath, context))\n            queryCollection.Add(New XPathMessageQuery(xpath2, context))\n            queryCollection.Add(New XPathMessageQuery(xpath3, context))\n            queryCollection.Add(New XPathMessageQuery(xpath4, context))\n            queryCollection.Add(New XPathMessageQuery(xpath5, context))\n            queryCollection.Add(New XPathMessageQuery(xpath6, context))\n            queryCollection.Add(New XPathMessageQuery(xpath7, context))\n            queryCollection.Add(New XPathMessageQuery(xpath8, context))\n            queryCollection.Add(New XPathMessageQuery(xpath9, context))\n            queryCollection.Add(New XPathMessageQuery(xpath10, context))\n            queryCollection.Add(New XPathMessageQuery(xpath11, context))\n\n            Return queryCollection\n        End Function\n\n        Public Shared Function SetupTable() As MessageQueryTable(Of String)\n\n            &#39; This is optional code to demonstrate using a MessageQueryTable.\n            &#39; Compare this to the MessageQueryCollection.\n            Dim table As MessageQueryTable(Of String) = New MessageQueryTable(Of String)()\n            Dim context As XPathMessageContext = New XPathMessageContext()\n\n\n            &#39; The code adds a KeyValuePair to the table. Each pair requires\n            &#39; a query used as the Key, and a value that is paired to the key.\n            table.Add(New XPathMessageQuery(xpath, context), &quot;value10&quot;)\n            table.Add(New XPathMessageQuery(xpath2, context), &quot;value20&quot;)\n            table.Add(New XPathMessageQuery(xpath3, context), &quot;value30&quot;)\n            table.Add(New XPathMessageQuery(xpath4, context), &quot;value40&quot;)\n            table.Add(New XPathMessageQuery(xpath5, context), &quot;value50&quot;)\n            table.Add(New XPathMessageQuery(xpath6, context), &quot;value60&quot;)\n            table.Add(New XPathMessageQuery(xpath7, context), &quot;value70&quot;)\n            table.Add(New XPathMessageQuery(xpath8, context), &quot;value80&quot;)\n            table.Add(New XPathMessageQuery(xpath9, context), &quot;value90&quot;)\n            table.Add(New XPathMessageQuery(xpath10, context), &quot;value100&quot;)\n            table.Add(New XPathMessageQuery(xpath11, context), &quot;value110&quot;)\n            Return table\n        End Function\n    End Class\nEnd Namespace\n</code></pre><pre><code class=\"lang-cs\" name=\"XPathMessageQuery#0\">using System;\nusing System.IO;\nusing System.Xml;\nusing System.ServiceModel.Dispatcher;\nusing System.ServiceModel;\nusing System.ServiceModel.Channels;\nusing System.Xml.XPath;\n\nnamespace MessageQueryExamples\n{\n    \n    class Program\n    {\n        static void Main(string[] args)\n        {\n            // The XPathMessageQueryCollection inherits from MessageQueryCollection.\n            XPathMessageQueryCollection queryCollection = MessageHelper.SetupQueryCollection();\n\n\n            // Create a message and a copy of the message. You must create a buffered copy to access the message body.\n            Message mess = MessageHelper.CreateMessage();\n            MessageBuffer mb = mess.CreateBufferedCopy(int.MaxValue);\n\n\n            // Evaluate every query in the collection. \n            foreach (XPathMessageQuery q in queryCollection)\n            {\n                // Evaluate the query. Note the result type is an XPathResult.\n                XPathResult qPathResult = q.Evaluate&lt;XPathResult&gt;(mb);\n\n                // Use the XPathResult to determine the result type.\n                Console.WriteLine(&quot;Result type: {0}&quot;, qPathResult.ResultType);\n\n                // The following code prints the result according to the result type.\n\n                if (qPathResult.ResultType == XPathResultType.String)\n                    Console.WriteLine(&quot;{0} = {1}&quot;, q.Expression, qPathResult.GetResultAsString());\n\n                if (qPathResult.ResultType == XPathResultType.NodeSet)\n                {\n                    // Iterate through the node set.\n                    XPathNodeIterator ns = qPathResult.GetResultAsNodeset();\n                    foreach (XPathNavigator n in ns)\n                        Console.WriteLine(&quot;\\t{0} = {1}&quot;, q.Expression, n.Value);\n                }\n                if (qPathResult.ResultType == XPathResultType.Number)\n                    Console.WriteLine(&quot;\\t{0} = {1}&quot;, q.Expression, qPathResult.GetResultAsNumber());\n\n                if (qPathResult.ResultType == XPathResultType.Boolean)\n                    Console.WriteLine(&quot;\\t{0} ={1}&quot;, q.Expression, qPathResult.GetResultAsBoolean());\n\n                if (qPathResult.ResultType == XPathResultType.Error)\n                    Console.WriteLine(&quot;\\tError!&quot;);\n            }\n\n            Console.WriteLine();\n\n            // The alternate code below demonstrates similar funcionality using a MessageQueryTable.\n            // The difference is the KeyValuePair that requires a key to index each value.\n            // The code uses the expression as the key, and an arbitrary value for the value.           \n\n            //MessageQueryTable&lt;string&gt; mq = MessageHelper.SetupTable();\n            //foreach (KeyValuePair&lt;MessageQuery, string&gt; kv in mq)\n            //{\n            //    XPathMessageQuery xp = (XPathMessageQuery)kv.Key;\n            //    Console.WriteLine(&quot;Value = {0}&quot;, kv.Value);\n            //    Console.WriteLine(&quot;{0} = {1}&quot;, xp.Expression, xp.Evaluate&lt;string&gt;(mb));\n            //}\n\n            Console.ReadLine();\n        }\n    }\n\n    public class MessageHelper\n    {\n        static string messageBody =\n              &quot;&lt;PurchaseOrder date=&#39;today&#39;&gt;&quot; +\n                  &quot;&lt;Number&gt;ABC-2009-XYZ&lt;/Number&gt;&quot; +\n                  &quot;&lt;Department&gt;OnlineSales&lt;/Department&gt;&quot; +\n                  &quot;&lt;Items&gt;&quot; +\n                      &quot;&lt;Item product=&#39;nail&#39; quantity=&#39;1&#39;&gt;item1&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;screw&#39; quantity=&#39;2&#39;&gt;item2&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;brad&#39; quantity=&#39;3&#39;&gt;&quot; +\n                          &quot;&lt;SpecialOffer/&gt;&quot; +\n                          &quot;Special item4&quot; +\n                      &quot;&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;SpecialNails&#39; quantity=&#39;9&#39;&gt;item5&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;SpecialBrads&#39; quantity=&#39;11&#39;&gt;&quot; +\n                          &quot;&lt;SpecialOffer/&gt;&quot; +\n                          &quot;Special item6&quot; +\n                      &quot;&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;hammer&#39; quantity=&#39;1&#39;&gt;item7&lt;/Item&gt;&quot; +\n                      &quot;&lt;Item product=&#39;wrench&#39; quantity=&#39;2&#39;&gt;item8&lt;/Item&gt;&quot; +\n                  &quot;&lt;/Items&gt;&quot; +\n                &quot;&lt;Comments&gt;&quot; +\n                &quot;Rush order&quot; +\n                &quot;&lt;/Comments&gt;&quot; +\n              &quot;&lt;/PurchaseOrder&gt;&quot;;\n\n        public static string xpath = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@quantity = 1]&quot;;\n        public static string xpath2 = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@product = &#39;nail&#39;]&quot;;\n        public static string xpath3 = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Comments&quot;;\n        public static string xpath4 = &quot;count(/s12:Envelope/s12:Body/PurchaseOrder/Items/Item)&quot;;\n        public static string xpath5 = &quot;substring(string(/s12:Envelope/s12:Body/PurchaseOrder/Number),5,4)&quot;;\n        public static string xpath6 = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Department=&#39;OnlineSales&#39;&quot;;\n        public static string xpath7 = &quot;//PurchaseOrder/@date&quot;;\n        public static string xpath8 = &quot;//SpecialOffer/ancestor::Item[@product = &#39;brad&#39;]&quot;;\n\n        // Invoke the correlation data function.\n\n\n        public static string xpath9 = &quot;sm:correlation-data(&#39;CorrelationData1&#39;)&quot;;\n        public static string xpath10 = &quot;sm:correlation-data(&#39;CorrelationData2&#39;)&quot;;\n\n        public static string xpath11 = &quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@quantity = 2]&quot;;\n\n\n        public static Message CreateMessage()\n        {\n            StringReader stringReader = new StringReader(messageBody);\n            XmlTextReader xmlReader = new XmlTextReader(stringReader);\n            Message message = Message.CreateMessage(MessageVersion.Soap12WSAddressing10, &quot;http://purchaseorder&quot;, xmlReader);\n\n            // Add two correlation properties using lambda expressions. The property names are\n            // CorrelationData1 and CorrelationData2. The first goes to &quot;value1&quot; and the\n            // second to &quot;value2&quot;. You can use your own property names and values.\n            CorrelationDataMessageProperty data = new CorrelationDataMessageProperty();\n\n            data.Add(&quot;CorrelationData1&quot;, () =&gt; &quot;value1&quot;);\n            data.Add(&quot;CorrelationData2&quot;, () =&gt; &quot;value2&quot;);\n            message.Properties[CorrelationDataMessageProperty.Name] = data;\n\n            return message;\n        }\n\n\n\n        public static XPathMessageQueryCollection SetupQueryCollection()\n        {\n            // Create the query collection and add the XPath queries to it. To create\n            // the query, you must also use a new XPathMessageContext.\n\n            XPathMessageQueryCollection queryCollection = new XPathMessageQueryCollection();\n\n            XPathMessageContext context = new XPathMessageContext();\n            queryCollection.Add(new XPathMessageQuery(xpath, context));\n            queryCollection.Add(new XPathMessageQuery(xpath2, context));\n            queryCollection.Add(new XPathMessageQuery(xpath3, context));\n            queryCollection.Add(new XPathMessageQuery(xpath4, context));\n            queryCollection.Add(new XPathMessageQuery(xpath5, context));\n            queryCollection.Add(new XPathMessageQuery(xpath6, context));\n            queryCollection.Add(new XPathMessageQuery(xpath7, context));\n            queryCollection.Add(new XPathMessageQuery(xpath8, context));\n            queryCollection.Add(new XPathMessageQuery(xpath9, context));\n            queryCollection.Add(new XPathMessageQuery(xpath10, context));\n            queryCollection.Add(new XPathMessageQuery(xpath11, context));\n\n            return queryCollection;\n        }\n\n        public static MessageQueryTable&lt;string&gt; SetupTable()\n        {\n            // This is optional code to demonstrate using a MessageQueryTable.\n            // Compare this to the MessageQueryCollection.\n            MessageQueryTable&lt;string&gt; table = new MessageQueryTable&lt;string&gt;();\n            XPathMessageContext context = new XPathMessageContext();\n\n\n            // The code adds a KeyValuePair to the table. Each pair requires\n            // a query used as the Key, and a value that is paired to the key.\n            table.Add(new XPathMessageQuery(xpath, context), &quot;value10&quot;);\n            table.Add(new XPathMessageQuery(xpath2, context), &quot;value20&quot;);\n            table.Add(new XPathMessageQuery(xpath3, context), &quot;value30&quot;);\n            table.Add(new XPathMessageQuery(xpath4, context), &quot;value40&quot;);\n            table.Add(new XPathMessageQuery(xpath5, context), &quot;value50&quot;);\n            table.Add(new XPathMessageQuery(xpath6, context), &quot;value60&quot;);\n            table.Add(new XPathMessageQuery(xpath7, context), &quot;value70&quot;);\n            table.Add(new XPathMessageQuery(xpath8, context), &quot;value80&quot;);\n            table.Add(new XPathMessageQuery(xpath9, context), &quot;value90&quot;);\n            table.Add(new XPathMessageQuery(xpath10, context), &quot;value100&quot;);\n            table.Add(new XPathMessageQuery(xpath11, context), &quot;value110&quot;);\n            return table;\n        }\n    }    \n}\n</code></pre>\r\n  \r\n  \t<h2 class=\"accented\">Remarks</h2>\r\n  \t<p>The MessageQuery class is similar to the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagefilter\" data-linktype=\"relative-path\">MessageFilter</a> class.  However, instead of returning matches, the <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/dd270251(v=vs.110).aspx\" data-linktype=\"external\">Evaluate</a> method returns the results of evaluating a query against a message. The result of the query is a value in the message. Use the value as a key to correlate the message to other messages. To add a new property for the data, use the <a class=\"xref\" href=\"system.servicemodel.channels.correlationdatamessageproperty#System_ServiceModel_Channels_CorrelationDataMessageProperty_Add_\" data-linktype=\"relative-path\">Add</a> method of the <a class=\"xref\" href=\"system.servicemodel.channels.correlationdatamessageproperty\" data-linktype=\"relative-path\">CorrelationDataMessageProperty</a> class.  </p>\n<div class=\"NOTE\"><h5>Note</h5><p> For a concrete implementation of the MessageQuery, see the <a class=\"xref\" href=\"system.servicemodel.xpathmessagequery\" data-linktype=\"relative-path\">XPathMessageQuery</a> class.  </p>\n</div>\n<h3 class=\"accented\" id=\"using-the-xpathmessagequery-and-messagequerycollection-classes\">Using the XPathMessageQuery and MessageQueryCollection classes</h3>\n<p> You can optimize the query process by creating a set of query objects and inserting them into an instance of the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a> class.  </p>\n<div class=\"NOTE\"><h5>Note</h5><p> For a concrete implementation of the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a>, see the <a class=\"xref\" href=\"system.servicemodel.dispatcher.xpathmessagequerycollection\" data-linktype=\"relative-path\">XPathMessageQueryCollection</a> class.  </p>\n</div>\n<p> A common usage is to populate the collection with queries that have the same XPath predicate, but that differ only in the final leaf value. For example, the following XPath queries are identical except for the final clause. The first queries for all elements that have the quantity attribute set to 1, and the second queries for elements with the product attribute set to &#39;Contoso&#39;):  </p>\n<pre><code>&quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@quantity = 1]&quot;  \n&quot;/s12:Envelope/s12:Body/PurchaseOrder/Items/Item[@product = &#39;Contoso&#39;]&quot;  \n</code></pre><p> The <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a> class allows you to create tables of queries that differ only slightly, enabling more efficient processing.  </p>\n<p> Alternatively, you can use the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerytable-1\" data-linktype=\"relative-path\">MessageQueryTable&lt;TItem&gt;</a> class to store and evaluate message queries.</p>\n\r\n  \r\n  \r\n  \t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Constructors\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_ServiceModel_Dispatcher_MessageQuery__ctor_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_ServiceModel_Dispatcher_MessageQuery__ctor\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">MessageQuery()</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Initializes a new instance of the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequery\" data-linktype=\"relative-path\">MessageQuery</a> class.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected MessageQuery ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\r\n  \t\t</section>\t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Methods\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_ServiceModel_Dispatcher_MessageQuery_CreateMessageQueryCollection_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_ServiceModel_Dispatcher_MessageQuery_CreateMessageQueryCollection\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">CreateMessageQueryCollection()</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Creates a collection of queries that returns a specific type of data associated with it.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public virtual System.ServiceModel.Dispatcher.MessageQueryCollection CreateMessageQueryCollection ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Returns</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<div class=\"subtle\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a></span>\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t<p><a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a> The collection of queries associated with the data type.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>This method is intended to be used by the <a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a> class.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_ServiceModel_Dispatcher_MessageQuery_Evaluate__1_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_ServiceModel_Dispatcher_MessageQuery_Evaluate__1_System_ServiceModel_Channels_Message_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Evaluate&lt;TResult&gt;(Message)</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>When overridden in a derived class, runs a query against the message and returns a result. The body cannot be queried.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public abstract TResult Evaluate&lt;TResult&gt; (System.ServiceModel.Channels.Message message);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Parameters</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>message</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.servicemodel.channels.message\" data-linktype=\"relative-path\">Message</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p>The message to query.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Returns</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<div class=\"subtle\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><span class=\"xref\">TResult</span></span>\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t<a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a>  \n\n<p> An enumerable collection of results that satisfy the query.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\t\t\t<div data-moniker=\" netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_ServiceModel_Dispatcher_MessageQuery_Evaluate__1_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_ServiceModel_Dispatcher_MessageQuery_Evaluate__1_System_ServiceModel_Channels_MessageBuffer_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Evaluate&lt;TResult&gt;(MessageBuffer)</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>When overridden in a derived class, runs a query against the message and returns a result.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public abstract TResult Evaluate&lt;TResult&gt; (System.ServiceModel.Channels.MessageBuffer buffer);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Parameters</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>buffer</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.servicemodel.channels.messagebuffer\" data-linktype=\"relative-path\">MessageBuffer</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p>The message to query.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Returns</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<div class=\"subtle\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><span class=\"xref\">TResult</span></span>\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t<a class=\"xref\" href=\"system.servicemodel.dispatcher.messagequerycollection\" data-linktype=\"relative-path\">MessageQueryCollection</a>  \n\n<p> An enumerable collection of results that satisfy the query.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\r\n  \t\t</section>\r\n  \r\n  \r\n","outputRootRelativePath":"../","pageMetadata":"<meta name=\"author\" content=\"dotnet-bot\">\r\n<meta name=\"ms.author\" content=\"dotnetcontent\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"apiPlatform\" content=\"dotnet\">\r\n<meta name=\"ms.topic\" content=\"managed-reference\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/api/System.ServiceModel.Dispatcher.MessageQuery.yml\">\r\n<meta name=\"APIName\" content=\"System.ServiceModel.Dispatcher.MessageQuery\">\r\n<meta name=\"APIName\" content=\"System.ServiceModel.Dispatcher.MessageQuery..ctor\">\r\n<meta name=\"APIName\" content=\"System.ServiceModel.Dispatcher.MessageQuery.CreateMessageQueryCollection\">\r\n<meta name=\"APIName\" content=\"System.ServiceModel.Dispatcher.MessageQuery.Evaluate&lt;TResult&gt;\">\r\n<meta name=\"APILocation\" content=\"System.ServiceModel.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2017-03-31 02:21 PM\">\r\n<meta name=\"document_id\" content=\"addbdedd-5458-ecce-673c-732b3db91690\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"Defines the core behavior of classes used to search for specific correlating data in a message.\n\">\r\n<meta name=\"toc_rel\" content=\"_splitted/system.servicemodel.dispatcher/toc2.json\">\r\n<meta name=\"source_url\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"System.ServiceModel.Dispatcher.MessageQuery\">\r\n","rawMetadata":{"author":"dotnet-bot","ms.author":"dotnetcontent","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","apiPlatform":"dotnet","ms.topic":"managed-reference","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitRefSkeletonCommitHistory":[],"original_ref_skeleton_git_url":"https://github.com/dotnet/docs-internal/blob/master/api/System.ServiceModel.Dispatcher.MessageQuery.yml","open_to_public_contributors":false,"api_name":["System.ServiceModel.Dispatcher.MessageQuery","System.ServiceModel.Dispatcher.MessageQuery..ctor","System.ServiceModel.Dispatcher.MessageQuery.CreateMessageQueryCollection","System.ServiceModel.Dispatcher.MessageQuery.Evaluate<TResult>"],"api_location":["System.ServiceModel.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.ServiceModel.Dispatcher.MessageQuery","System::ServiceModel::Dispatcher::MessageQuery","System.ServiceModel.Dispatcher.MessageQuery.#ctor","System::ServiceModel::Dispatcher::MessageQuery::#ctor","System.ServiceModel.Dispatcher.MessageQuery.CreateMessageQueryCollection","System::ServiceModel::Dispatcher::MessageQuery::CreateMessageQueryCollection","System.ServiceModel.Dispatcher.MessageQuery.Evaluate``1","System::ServiceModel::Dispatcher::MessageQuery::Evaluate``1"],"dev_langs":["csharp"],"updated_at":"2017-03-31 02:21 PM","document_id":"addbdedd-5458-ecce-673c-732b3db91690","content_git_url":"https://github.com/dotnet/docs-internal/blob/master/xml/System.ServiceModel.Dispatcher/MessageQuery.xml","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"MessageQuery class | Microsoft Docs","_op_ogTitle":"MessageQuery class","description":"Defines the core behavior of classes used to search for specific correlating data in a message.\n","toc_asset_id":"api/_splitted/System.ServiceModel.Dispatcher/toc.json","toc_rel":"_splitted/System.ServiceModel.Dispatcher/toc.json","source_url":"","ms.assetid":"System.ServiceModel.Dispatcher.MessageQuery","canonical_url":"https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.dispatcher.messagequery","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/api/system.servicemodel.dispatcher.messagequery","fileRelativePath":"api/System.ServiceModel.Dispatcher.MessageQuery.html"},"themesRelativePathToOutputRoot":"_themes/"}