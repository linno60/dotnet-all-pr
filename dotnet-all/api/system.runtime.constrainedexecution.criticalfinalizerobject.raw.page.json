{"content":"\r\n  \r\n  <h1>\r\n    <span class=\"lang-csharp\">CriticalFinalizerObject</span>\r\n    \t\t\t\tClass\r\n  </h1>\r\n  \r\n  <h2 class=\"hiddenAnchor\">Definition</h2>\r\n  \r\n  <div class=\"metadata\">\r\n  \r\n  \r\n  </div>\r\n  \r\n  <div class=\"summaryHolder\">\r\n  \t<div class=\"summary\">\r\n  \t\t<p>Ensures that all finalization code in derived classes is marked as critical.</p>\n\r\n  \t</div>\r\n  </div><nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n    <h3>In this Article</h3>\r\n  </nav>\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\">[System.Runtime.InteropServices.ComVisible(true)]\npublic abstract class CriticalFinalizerObject</code></pre>\r\n  \r\n  \r\n  \r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Inheritance</dt><dd>\r\n  \t\t<div class=\"pdlHolder\">\r\n  \t\t<div class=\"pdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a></span></div><span class=\"lang-csharp\">CriticalFinalizerObject</span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Derived</dt><dd>\r\n  \t\t<div class=\"cdlHolder\">\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.runtime.memoryfailpoint\" data-linktype=\"relative-path\">MemoryFailPoint</a></span></div>\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a></span></div>\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a></span></div>\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.threading.readerwriterlock\" data-linktype=\"relative-path\">ReaderWriterLock</a></span></div>\r\n        \t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.threading.thread\" data-linktype=\"relative-path\">Thread</a></span></div>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Attributes</dt><dd>\r\n  \t\t<div class=\"cdlHolder\">\r\n  \t\t\t<span class=\"cdl\"><a class=\"xref\" href=\"system.runtime.interopservices.comvisibleattribute\" title=\"System.Runtime.InteropServices.ComVisibleAttribute\" data-linktype=\"relative-path\">ComVisibleAttribute</a></span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \r\n  \t<h3 class=\"accented\">Inherited Members</h3>\r\n  \t<h4 class=\"accented\"></h4>\r\n  \t<div class=\"cdlHolder\">\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_\" data-linktype=\"relative-path\">Equals(Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_System_Object_\" data-linktype=\"relative-path\">Equals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetHashCode\" data-linktype=\"relative-path\">GetHashCode()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetType\" data-linktype=\"relative-path\">GetType()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_MemberwiseClone\" data-linktype=\"relative-path\">MemberwiseClone()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ReferenceEquals_System_Object_System_Object_\" data-linktype=\"relative-path\">ReferenceEquals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ToString\" data-linktype=\"relative-path\">ToString()</a></span></div>\r\n  \t</div>\r\n  \r\n  \t<h2 class=\"accented\">Examples</h2>\r\n  \t<p>The following code example shows the use of the <a class=\"xref\" href=\"microsoft.win32.safehandles.safefilehandle\" data-linktype=\"relative-path\">SafeFileHandle</a> class to provide critical finalization for the standard input and output streams. The <a class=\"xref\" href=\"microsoft.win32.safehandles.safefilehandle\" data-linktype=\"relative-path\">SafeFileHandle</a>, derived from the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class, is passed to the file stream in the <a class=\"xref\" href=\"system.io.filestream\" data-linktype=\"relative-path\">FileStream</a> constructor.  </p>\n<pre><code class=\"lang-cs\" name=\"SafeHandle.SafeFileHandle#1\">using System;\nusing System.Runtime.InteropServices;\nusing System.IO;\nusing Microsoft.Win32.SafeHandles;\n\nnamespace CriticalFinalizer\n{\n    class Program\n    {\n        const int STD_INPUT_HANDLE   = -10;\n        const int STD_OUTPUT_HANDLE = -11;\n        const int STD_ERROR_HANDLE  =  -12;\n        [DllImport(&quot;Kernel32.dll&quot;, CharSet = System.Runtime.InteropServices.CharSet.Auto)]\n        public static extern IntPtr GetStdHandle(int type);\n\n        static void Main(string[] args)\n        {\n            FileStream fsIn = null;\n            FileStream fsOut = null;\n            try\n            {\n                SafeFileHandle sfhIn = new SafeFileHandle(GetStdHandle(STD_INPUT_HANDLE), false);\n                fsIn = new FileStream(sfhIn, FileAccess.Read);\n                byte[] input = new byte[] {0};\n                fsIn.Read(input,0,1);\n                SafeFileHandle sfhOut = new SafeFileHandle(GetStdHandle(STD_OUTPUT_HANDLE), false);\n                fsOut = new FileStream(sfhOut, FileAccess.Write);\n                fsOut.Write(input,0,1);\n                SafeFileHandle sf = fsOut.SafeFileHandle;\n            }\n            finally\n            {\n                if (fsIn != null)\n                {\n                    fsIn.Close();\n                    fsIn = null;\n                }\n                if (fsOut != null)\n                {\n                    fsOut.Close();\n                    fsOut = null;\n                }\n            }\n        }\n        \n    }\n}\n</code></pre><pre><code class=\"lang-vb\" name=\"SafeHandle.SafeFileHandle#1\">Imports System.Runtime.InteropServices\nImports System.IO\nImports Microsoft.Win32.SafeHandles\n\nPublic Module Example\n   Const STD_INPUT_HANDLE As Integer  = -10\n   Const STD_OUTPUT_HANDLE As Integer = -11\n   Const STD_ERROR_HANDLE As Integer  = -12\n\n   Public Declare Auto Function GetStdHandle Lib &quot;Kernel32&quot; (type As Integer) As IntPtr\n\n   Public Sub Main()\n      Dim fsIn As FileStream = Nothing\n      Dim fsOut As FileStream = Nothing\n\n      Try\n         Dim sfhIn As New SafeFileHandle(GetStdHandle(STD_INPUT_HANDLE), False)\n         fsIn = new FileStream(sfhIn, FileAccess.Read)\n         Dim input() As Byte = { 0 }\n         fsIn.Read(input, 0, 1)\n         Dim sfhOut As New SafeFileHandle(GetStdHandle(STD_OUTPUT_HANDLE), False)\n         fsOut = New FileStream(sfhOut, FileAccess.Write)\n         fsOut.Write(input, 0, 1)\n         Dim sf As SafeFileHandle = fsOut.SafeFileHandle\n      Finally\n         If fsIn IsNot Nothing Then\n            fsIn.Close()\n            fsIn = Nothing\n         End If\n         If fsOut IsNot Nothing Then \n            fsOut.Close()\n            fsOut = Nothing\n         End If\n      End Try\n   End Sub\nEnd Module\n</code></pre>\r\n  \r\n  \t<h2 class=\"accented\">Remarks</h2>\r\n  \t<p>Classes deriving from the CriticalFinalizerObject class are implicitly treated as a constrained execution region (CER).  This requires code in the finalizer to only call code with a strong reliability contract. For more information about CERs, see the <a class=\"xref\" href=\"system.runtime.constrainedexecution\" data-linktype=\"relative-path\">System.Runtime.ConstrainedExecution</a> namespace.  </p>\n<p> In classes derived from the CriticalFinalizerObject class, the common language runtime (CLR) guarantees that all critical finalization code will be given the opportunity to execute, provided the finalizer follows the rules for a CER, even in situations where the CLR forcibly unloads an application domain or aborts a thread. If a finalizer violates the rules for a CER, it might not successfully execute. In addition, the CLR establishes a weak ordering among normal and critical finalizers: for objects reclaimed by garbage collection at the same time, all the noncritical finalizers are called before any of the critical finalizers. For example, a class such as <a class=\"xref\" href=\"system.io.filestream\" data-linktype=\"relative-path\">FileStream</a>, which holds data in the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class that is derived from CriticalFinalizerObject, can run a standard finalizer to flush out existing buffered data.  </p>\n<p> In most cases, you do not need to write classes that derive from the CriticalFinalizerObject class. The .NET Framework class library provides two classes, <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> and <a class=\"xref\" href=\"system.runtime.interopservices.criticalhandle\" data-linktype=\"relative-path\">CriticalHandle</a>, that provide critical finalization functionality for handle resources. Furthermore, the .NET Framework provides a set of prewritten classes derived from the <a class=\"xref\" href=\"system.runtime.interopservices.safehandle\" data-linktype=\"relative-path\">SafeHandle</a> class, and this set is located in the <a class=\"xref\" href=\"microsoft.win32.safehandles\" data-linktype=\"relative-path\">Microsoft.Win32.SafeHandles</a> namespace. These classes are designed to provide common functionality for supporting file and operating system handles.</p>\n\r\n  \r\n  \r\n  \t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Constructors\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_Runtime_ConstrainedExecution_CriticalFinalizerObject__ctor_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_ConstrainedExecution_CriticalFinalizerObject__ctor\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">CriticalFinalizerObject()</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Initializes a new instance of the <a class=\"xref\" href=\"system.runtime.constrainedexecution.criticalfinalizerobject\" data-linktype=\"relative-path\">CriticalFinalizerObject</a> class.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">protected CriticalFinalizerObject ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Attributes</dt><dd>\r\n  \t\t\t\t\t\t\t\t<div class=\"cdlHolder\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"cdl\"><a class=\"xref\" href=\"system.runtime.constrainedexecution.reliabilitycontractattribute\" title=\"System.Runtime.ConstrainedExecution.ReliabilityContractAttribute\" data-linktype=\"relative-path\">ReliabilityContractAttribute</a></span>\r\n  \t\t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\r\n  \t\t</section>\t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Methods\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_Runtime_ConstrainedExecution_CriticalFinalizerObject_Finalize_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_ConstrainedExecution_CriticalFinalizerObject_Finalize\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">Finalize()</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Releases all the resources used by the <a class=\"xref\" href=\"system.runtime.constrainedexecution.criticalfinalizerobject\" data-linktype=\"relative-path\">CriticalFinalizerObject</a> class.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">~CriticalFinalizerObject ();</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Attributes</dt><dd>\r\n  \t\t\t\t\t\t\t\t<div class=\"cdlHolder\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"cdl\"><a class=\"xref\" href=\"system.runtime.constrainedexecution.reliabilitycontractattribute\" title=\"System.Runtime.ConstrainedExecution.ReliabilityContractAttribute\" data-linktype=\"relative-path\">ReliabilityContractAttribute</a></span>\r\n  \t\t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>The finalizer for any types deriving from <a class=\"xref\" href=\"system.runtime.constrainedexecution.criticalfinalizerobject\" data-linktype=\"relative-path\">CriticalFinalizerObject</a> is given the opportunity to execute and will not be aborted, assuming the finalizer correctly follows the rules for a constrained execution region (CER).</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\r\n  \t\t</section>\r\n  \r\n  \r\n","outputRootRelativePath":"../","pageMetadata":"<meta name=\"author\" content=\"dotnet-bot\">\r\n<meta name=\"ms.author\" content=\"dotnetcontent\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"apiPlatform\" content=\"dotnet\">\r\n<meta name=\"ms.topic\" content=\"managed-reference\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"uhfHeaderId\" content=\"MSDocsHeader-DotNet\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.ConstrainedExecution.CriticalFinalizerObject.yml\">\r\n<meta name=\"APIName\" content=\"System.Runtime.ConstrainedExecution.CriticalFinalizerObject\">\r\n<meta name=\"APIName\" content=\"System.Runtime.ConstrainedExecution.CriticalFinalizerObject..ctor\">\r\n<meta name=\"APIName\" content=\"System.Runtime.ConstrainedExecution.CriticalFinalizerObject.Finalize\">\r\n<meta name=\"APILocation\" content=\"mscorlib.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2017-04-01 05:59 PM\">\r\n<meta name=\"document_id\" content=\"fdbae69d-e995-00bd-72ab-d4cf6bf85196\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"Ensures that all finalization code in derived classes is marked as critical.\n\">\r\n<meta name=\"toc_rel\" content=\"_splitted/system.runtime.constrainedexecution/toc2.json\">\r\n<meta name=\"source_url\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"System.Runtime.ConstrainedExecution.CriticalFinalizerObject\">\r\n","rawMetadata":{"author":"dotnet-bot","ms.author":"dotnetcontent","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","apiPlatform":"dotnet","ms.topic":"managed-reference","ms.prod":".net","uhfHeaderId":"MSDocsHeader-DotNet","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitRefSkeletonCommitHistory":[],"original_ref_skeleton_git_url":"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.ConstrainedExecution.CriticalFinalizerObject.yml","open_to_public_contributors":false,"api_name":["System.Runtime.ConstrainedExecution.CriticalFinalizerObject","System.Runtime.ConstrainedExecution.CriticalFinalizerObject..ctor","System.Runtime.ConstrainedExecution.CriticalFinalizerObject.Finalize"],"api_location":["mscorlib.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.Runtime.ConstrainedExecution.CriticalFinalizerObject","System::Runtime::ConstrainedExecution::CriticalFinalizerObject","System.Runtime.ConstrainedExecution.CriticalFinalizerObject.#ctor","System::Runtime::ConstrainedExecution::CriticalFinalizerObject::#ctor","System.Runtime.ConstrainedExecution.CriticalFinalizerObject.Finalize","System::Runtime::ConstrainedExecution::CriticalFinalizerObject::Finalize"],"dev_langs":["csharp"],"updated_at":"2017-04-01 05:59 PM","document_id":"fdbae69d-e995-00bd-72ab-d4cf6bf85196","content_git_url":"https://github.com/dotnet/docs-internal/blob/master/xml/System.Runtime.ConstrainedExecution/CriticalFinalizerObject.xml","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"CriticalFinalizerObject class | Microsoft Docs","_op_ogTitle":"CriticalFinalizerObject class","description":"Ensures that all finalization code in derived classes is marked as critical.\n","toc_asset_id":"api/_splitted/System.Runtime.ConstrainedExecution/toc.json","toc_rel":"_splitted/System.Runtime.ConstrainedExecution/toc.json","source_url":"","ms.assetid":"System.Runtime.ConstrainedExecution.CriticalFinalizerObject","canonical_url":"https://docs.microsoft.com/en-us/dotnet/api/system.runtime.constrainedexecution.criticalfinalizerobject","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/api/system.runtime.constrainedexecution.criticalfinalizerobject","fileRelativePath":"api/System.Runtime.ConstrainedExecution.CriticalFinalizerObject.html"},"themesRelativePathToOutputRoot":"_themes/"}