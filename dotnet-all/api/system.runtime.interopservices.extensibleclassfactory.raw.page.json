{"content":"\r\n  \r\n  <h1>\r\n    <span class=\"lang-csharp\">ExtensibleClassFactory</span>\r\n    \t\t\t\tClass\r\n  </h1>\r\n  \r\n  <h2 class=\"hiddenAnchor\">Definition</h2>\r\n  \r\n  <div class=\"metadata\">\r\n  \r\n  \r\n  </div>\r\n  \r\n  <div class=\"summaryHolder\">\r\n  \t<div class=\"summary\">\r\n  \t\t<p>Enables customization of managed objects that extend from unmanaged objects during creation.</p>\n\r\n  \t</div>\r\n  </div><nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n    <h3>In this Article</h3>\r\n  </nav>\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\">[ECMA2Yaml.Models.ECMAAttribute]\npublic sealed class ExtensibleClassFactory</code></pre>\r\n  \r\n  \r\n  \r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Inheritance</dt><dd>\r\n  \t\t<div class=\"pdlHolder\">\r\n  \t\t<div class=\"pdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object\" data-linktype=\"relative-path\">Object</a></span></div><span class=\"lang-csharp\">ExtensibleClassFactory</span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \r\n  \t<dl class=\"attributeList stack\">\r\n  \t\t<dt>Attributes</dt><dd>\r\n  \t\t<div class=\"cdlHolder\">\r\n  \t\t\t<span class=\"cdl\"><a class=\"xref\" href=\"system.runtime.interopservices.comvisibleattribute\" title=\"System.Runtime.InteropServices.ComVisibleAttribute\" data-linktype=\"relative-path\">ComVisibleAttribute</a></span>\r\n  \t\t</div>\r\n  \t\t</dd>\r\n  \t</dl>\r\n  \r\n  \r\n  \t<h3 class=\"accented\">Inherited Members</h3>\r\n  \t<h4 class=\"accented\"></h4>\r\n  \t<div class=\"cdlHolder\">\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_\" data-linktype=\"relative-path\">Equals(Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_Equals_System_Object_System_Object_\" data-linktype=\"relative-path\">Equals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetHashCode\" data-linktype=\"relative-path\">GetHashCode()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_GetType\" data-linktype=\"relative-path\">GetType()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_MemberwiseClone\" data-linktype=\"relative-path\">MemberwiseClone()</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ReferenceEquals_System_Object_System_Object_\" data-linktype=\"relative-path\">ReferenceEquals(Object, Object)</a></span></div>\r\n  \t\t\t<div class=\"cdl\"><span class=\"lang-csharp\"><a class=\"xref\" href=\"system.object#System_Object_ToString\" data-linktype=\"relative-path\">ToString()</a></span></div>\r\n  \t</div>\r\n  \r\n  \t<h2 class=\"accented\">Examples</h2>\r\n  \t<p>Registers a <code>delegate</code> that will be called whenever an instance of a managed type that extends from an unmanaged type needs to allocate the aggregated unmanaged object. This <code>delegate</code> is expected to allocate and aggregate the unmanaged object and is called in place of a <code>CoCreateInstance</code>. This routine must be called in the context of the <code>static</code> initializer for the class for which the callbacks will be made.  </p>\n<pre><code class=\"lang-cs\" name=\"Classic ExtensibleClassFactory Example#1\">using System;\nusing System.Runtime.InteropServices;\n\npublic class CallBack\n{\n   public IntPtr Activate(IntPtr Aggregator)\n   {\n      ECFSRV32Lib.ObjectActivator oCOM = new ECFSRV32Lib.ObjectActivator();\n      ECFSRV32Lib.IObjectActivator itf = (ECFSRV32Lib.IObjectActivator)oCOM;\n      return (IntPtr) itf.CreateBaseComponent((int)Aggregator);\n   }\n}\n\n//\n// The EcfInner class. First .NET class derived directly from COM class.\n//\npublic class EcfInner : ECFSRV32Lib.BaseComponent\n{\n   static CallBack callbackInner;\n\n   static void RegisterInner()\n   {      \n      callbackInner = new CallBack();\n      System.Runtime.InteropServices.ExtensibleClassFactory.RegisterObjectCreationCallback(new System.Runtime.InteropServices.ObjectCreationDelegate(callbackInner.Activate));\n   }\n\n   //This is the static initializer.    \n   static EcfInner()\n   {\n      RegisterInner();\n   }\n}\n</code></pre><pre><code class=\"lang-cpp\" name=\"Classic ExtensibleClassFactory Example#1\">public ref class CallBack\n{\npublic:\n   IntPtr Activate( IntPtr Aggregator )\n   {\n      ECFSRV32Lib::ObjectActivator^ oCOM = gcnew ECFSRV32Lib::ObjectActivator;\n      ECFSRV32Lib::IObjectActivator^ itf = dynamic_cast&lt;ECFSRV32Lib::IObjectActivator^&gt;(oCOM);\n      return (IntPtr)itf-&gt;CreateBaseComponent( (int)Aggregator );\n   }\n};\n\n//\n// The EcfInner class. First .NET class derived directly from COM class.\n//\npublic ref class EcfInner: public ECFSRV32Lib::BaseComponent\n{\nprivate:\n   static CallBack^ callbackInner;\n   static void RegisterInner()\n   {\n      callbackInner = gcnew CallBack;\n      System::Runtime::InteropServices::ExtensibleClassFactory::RegisterObjectCreationCallback( gcnew System::Runtime::InteropServices::ObjectCreationDelegate( callbackInner, &amp;CallBack::Activate ) );\n   }\n\n   //This is the static initializer.    \n   static EcfInner()\n   {\n      RegisterInner();\n   }\n};\n</code></pre><pre><code class=\"lang-vb\" name=\"Classic ExtensibleClassFactory Example#1\">Imports System\nImports System.Runtime.InteropServices\n\nPublic Class CallBack\n    \n    Public Function Activate(Aggregator As IntPtr) As IntPtr\n        Dim oCOM As New ECFSRV32Lib.ObjectActivator()\n        Dim itf As ECFSRV32Lib.IObjectActivator = _\n           CType(oCOM, ECFSRV32Lib.IObjectActivator)\n        Return New IntPtr(itf.CreateBaseComponent(Aggregator.ToInt32()))\n    End Function\nEnd Class\n\n&#39;\n&#39; The EcfInner class. First .NET class derived directly from COM class.\n&#39;\nPublic Class EcfInner\n    Inherits ECFSRV32Lib.BaseComponent\n    Private Shared callbackInner As CallBack    \n    \n    Shared Sub RegisterInner()\n        callbackInner = New CallBack()\n        ExtensibleClassFactory.RegisterObjectCreationCallback( _\n           New System.Runtime.InteropServices.ObjectCreationDelegate( _\n           AddressOf callbackInner.Activate))\n    End Sub    \n    \n    &#39;This is the static initializer.    \n    Shared Sub New()\n        RegisterInner()\n    End Sub\nEnd Class\n</code></pre>\r\n  \r\n  \t<h2 class=\"accented\">Remarks</h2>\r\n  \t<p>The <code>ExtensibleClassFactory</code> allows users to specify a <code>delegate</code> that is called during construction of a runtime callable wrapper (RCW) that provides an instance of the underlying COM object. In effect, the callback acts as the class factory for the COM object wrapped by the RCW. Without the callback, the common language runtime creates the underlying COM object by calling <code>CoCreateInstance</code>. This callback provides an alternative way of activating the underlying object, such as with a COM moniker or by providing a singleton object. The <a class=\"xref\" href=\"system.runtime.interopservices.extensibleclassfactory#System_Runtime_InteropServices_ExtensibleClassFactory_RegisterObjectCreationCallback_\" data-linktype=\"relative-path\">RegisterObjectCreationCallback</a> method must be called in the <code>static</code> initializer of the class that is extending the RCW. Only one object creation callback is permitted per object type. When the extensible RCW is activated, the callback is registered. When the underlying COM object needs to be created, the callback is called to provide a reference to the object. The callback must return an <code>IUnknown</code> interface pointer for the base object.</p>\n\r\n  \r\n  \r\n  \t\t<section>\r\n  \t\t\t<h2 class=\"accented \">Methods\r\n  \t\t</h2>\r\n  \t\t\r\n  \t\t\t\t\t<div data-moniker=\" netframework-3.0 netframework-3.5-client netframework-3.5 netframework-4.0-client netframework-4.0 netframework-4.5.1 netframework-4.5.2 netframework-4.5 netframework-4.6.1 netframework-4.6.2 netframework-4.6\">\r\n  \t\t\r\n  \t\t\t\t\t<a id=\"System_Runtime_InteropServices_ExtensibleClassFactory_RegisterObjectCreationCallback_\"></a>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberNameHolder\" id=\"System_Runtime_InteropServices_ExtensibleClassFactory_RegisterObjectCreationCallback_System_Runtime_InteropServices_ObjectCreationDelegate_\">\r\n  \t\t\t\t\t<h3 class=\"accented\">\r\n  \t\t\t\t\t\t<span class=\"lang-csharp\">RegisterObjectCreationCallback(ObjectCreationDelegate)</span>\r\n  \t\t\t\t\t</h3>\r\n  \t\t\t\t</div>\r\n  \t\t\r\n  \t\t\t\t<div class=\"memberInfo\">\r\n  \t\t\t\t\t<p>Registers a <code>delegate</code> that is called when an instance of a managed type, that extends from an unmanaged type, needs to allocate the aggregated unmanaged object.</p>\n\r\n  \t\t\r\n  \t\t\t\t\t\t<pre class=\"wrap loading\"><code class=\"csharp lang-csharp\" dir=\"ltr\">public static void RegisterObjectCreationCallback (System.Runtime.InteropServices.ObjectCreationDelegate callback);</code></pre>\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfoTitle stack\">Parameters</div>\r\n  \t\t\t\t\t\t\t<div class=\"propertyInfo\">\r\n  \t\t\t\t\t\t\t<dl class=\"parameterList\">\r\n  \t\t\t\t\t\t\t\t<dt>callback</dt>\r\n  \t\t\t\t\t\t\t\t<dd>\r\n  \t\t\t\t\t\t\t\t\t\t<span class=\"lang-csharp\"><a class=\"xref\" href=\"system.runtime.interopservices.objectcreationdelegate\" data-linktype=\"relative-path\">ObjectCreationDelegate</a></span>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\t\t\t\t\t<p>A <code>delegate</code> that is called in place of <code>CoCreateInstance</code>.</p>\n\r\n  \t\t\t\t\t\t\t</div>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t\t<dl class=\"attributeList stack\">\r\n  \t\t\t\t\t\t\t\t<dt>Attributes</dt><dd>\r\n  \t\t\t\t\t\t\t\t<div class=\"cdlHolder\">\r\n  \t\t\t\t\t\t\t\t\t<span class=\"cdl\"><a class=\"xref\" href=\"system.security.securitysafecriticalattribute\" title=\"System.Security.SecuritySafeCriticalAttribute\" data-linktype=\"relative-path\">SecuritySafeCriticalAttribute</a></span>\r\n  \t\t\t\t\t\t\t\t</div>\r\n  \t\t\t\t\t\t\t\t</dd>\r\n  \t\t\t\t\t\t\t</dl>\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\r\n  \t\t\t\t\t\t<h4 class=\"accented\">Remarks</h4>\r\n  \t\t\t\t\t\t<p>This <code>delegate</code> allocates and aggregates the unmanaged object and is called in place of <code>CoCreateInstance</code>. This <code>delegate</code> must be registered in the context of the <code>static</code> class initializer for which the callbacks will be made.  </p>\n<p> Only one class in an hierarchy should register a <code>delegate</code> callback.</p>\n\r\n  \t\t\r\n  \t\t\t\t</div>\r\n  \t\t\t</div>\r\n  \t\t\r\n  \t\t</section>\r\n  \r\n  \r\n","outputRootRelativePath":"../","pageMetadata":"<meta name=\"author\" content=\"dotnet-bot\">\r\n<meta name=\"ms.author\" content=\"dotnetcontent\">\r\n<meta name=\"manager\" content=\"wpickett\">\r\n<meta name=\"breadcrumb_path\" content=\"../toc2.json\">\r\n<meta name=\"apiPlatform\" content=\"dotnet\">\r\n<meta name=\"ms.topic\" content=\"managed-reference\">\r\n<meta name=\"ms.prod\" content=\".net\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"docs-internal\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"MSDN\">\r\n<meta name=\"depot_name\" content=\"MSDN.docs-internal\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.InteropServices.ExtensibleClassFactory.yml\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.ExtensibleClassFactory\">\r\n<meta name=\"APIName\" content=\"System.Runtime.InteropServices.ExtensibleClassFactory.RegisterObjectCreationCallback\">\r\n<meta name=\"APILocation\" content=\"mscorlib.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2017-03-31 02:21 PM\">\r\n<meta name=\"document_id\" content=\"8995dfb3-b321-f7a2-6a49-a0bda822214a\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"Enables customization of managed objects that extend from unmanaged objects during creation.\n\">\r\n<meta name=\"toc_rel\" content=\"_splitted/system.runtime.interopservices/toc2.json\">\r\n<meta name=\"source_url\" content=\"\">\r\n<meta name=\"ms.assetid\" content=\"System.Runtime.InteropServices.ExtensibleClassFactory\">\r\n","rawMetadata":{"author":"dotnet-bot","ms.author":"dotnetcontent","manager":"wpickett","breadcrumb_path":"/dotnet/toc.json","apiPlatform":"dotnet","ms.topic":"managed-reference","ms.prod":".net","search.ms_sitename":"Docs","search.ms_docsetname":"docs-internal","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet-internal/","locale":"en-us","site_name":"Docs","search.ms_product":"MSDN","_op_openToPublicContributors":false,"depot_name":"MSDN.docs-internal","_op_gitRefSkeletonCommitHistory":[],"original_ref_skeleton_git_url":"https://github.com/dotnet/docs-internal/blob/master/api/System.Runtime.InteropServices.ExtensibleClassFactory.yml","open_to_public_contributors":false,"api_name":["System.Runtime.InteropServices.ExtensibleClassFactory","System.Runtime.InteropServices.ExtensibleClassFactory.RegisterObjectCreationCallback"],"api_location":["mscorlib.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.Runtime.InteropServices.ExtensibleClassFactory","System::Runtime::InteropServices::ExtensibleClassFactory","System.Runtime.InteropServices.ExtensibleClassFactory.RegisterObjectCreationCallback","System::Runtime::InteropServices::ExtensibleClassFactory::RegisterObjectCreationCallback"],"dev_langs":["csharp"],"updated_at":"2017-03-31 02:21 PM","document_id":"8995dfb3-b321-f7a2-6a49-a0bda822214a","content_git_url":"https://github.com/dotnet/docs-internal/blob/master/xml/System.Runtime.InteropServices/ExtensibleClassFactory.xml","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"ExtensibleClassFactory class | Microsoft Docs","_op_ogTitle":"ExtensibleClassFactory class","description":"Enables customization of managed objects that extend from unmanaged objects during creation.\n","toc_asset_id":"api/_splitted/System.Runtime.InteropServices/toc.json","toc_rel":"_splitted/System.Runtime.InteropServices/toc.json","source_url":"","ms.assetid":"System.Runtime.InteropServices.ExtensibleClassFactory","canonical_url":"https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.extensibleclassfactory","_op_searchScope":[".NET"],"_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.extensibleclassfactory","fileRelativePath":"api/System.Runtime.InteropServices.ExtensibleClassFactory.html"},"themesRelativePathToOutputRoot":"_themes/"}