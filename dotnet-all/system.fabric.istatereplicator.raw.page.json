{"content":"    \r\n    <h1 id=\"System_Fabric_IStateReplicator\">\r\n      <span class=\"lang-csharp\">IStateReplicator</span>\r\n      <span class=\"lang-vb\">IStateReplicator</span>\r\n        Interface\r\n    </h1>\r\n    \r\n    \r\n    <nav id=\"center-doc-outline\" class=\"doc-outline\" ms.cmpgrp=\"intopic toc\" role=\"navigation\" aria-label=\"On page navigation\">\r\n      <h3>In this Article</h3>\r\n    </nav><div class=\"summary\">\r\n    \t\t<div class=\"memberEditButton\">\r\n    \t\t\t<a href=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=14\" ms.cmpnm=\"editMember\" data-linktype=\"external\"><i class=\"icon icon-editor\"></i>Edit</a>\r\n    \t\t</div>\r\n    \t<p>Exposes replication-related functions of the <a class=\"xref\" href=\"system.fabric.fabricreplicator\" data-linktype=\"relative-path\">FabricReplicator</a> class that are used by <a class=\"xref\" href=\"system.fabric.istateprovider\" data-linktype=\"relative-path\">IStateProvider</a> to replicate state to ensure high availability. </p>\n\r\n    </div><h2>Syntax</h2>\r\n    \r\n    \t<h3>Declaration</h3>\r\n    \t<pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">public interface IStateReplicator</code><code class=\"vb lang-vb\">Public Interface IStateReplicator</code></pre>\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    <h2>Methods\r\n     summary</h2>\r\n    \r\n    <table class=\"nameValue\">\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Fabric_IStateReplicator_GetCopyStream\" data-linktype=\"self-bookmark\">GetCopyStream()</a></div>\r\n            <div class=\"lang-vb\"><a href=\"#System_Fabric_IStateReplicator_GetCopyStream\" data-linktype=\"self-bookmark\">GetCopyStream()</a></div>\r\n          </td>\r\n            <td>\r\n            <p>Gets copy stream.</p>\n\r\n            </td>\r\n        </tr>\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Fabric_IStateReplicator_GetReplicationStream\" data-linktype=\"self-bookmark\">GetReplicationStream()</a></div>\r\n            <div class=\"lang-vb\"><a href=\"#System_Fabric_IStateReplicator_GetReplicationStream\" data-linktype=\"self-bookmark\">GetReplicationStream()</a></div>\r\n          </td>\r\n            <td>\r\n            <p>Gets replication stream.</p>\n\r\n            </td>\r\n        </tr>\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Fabric_IStateReplicator_ReplicateAsync_System_Fabric_OperationData_System_Threading_CancellationToken_System_Int64__\" data-linktype=\"self-bookmark\">ReplicateAsync(OperationData, CancellationToken, out Int64)</a></div>\r\n            <div class=\"lang-vb\"><a href=\"#System_Fabric_IStateReplicator_ReplicateAsync_System_Fabric_OperationData_System_Threading_CancellationToken_System_Int64__\" data-linktype=\"self-bookmark\">ReplicateAsync(OperationData, CancellationToken, ByRef Int64)</a></div>\r\n          </td>\r\n            <td>\r\n            <p>Replicates state changes from Primary replica to the Secondary replicas and receives a quorum acknowledgement that those state changes have been applied.</p>\n\r\n            </td>\r\n        </tr>\r\n        <tr class=\" enable-platform-filter\">\r\n          <td>\r\n            <div class=\"lang-csharp\"><a href=\"#System_Fabric_IStateReplicator_UpdateReplicatorSettings_System_Fabric_ReplicatorSettings_\" data-linktype=\"self-bookmark\">UpdateReplicatorSettings(ReplicatorSettings)</a></div>\r\n            <div class=\"lang-vb\"><a href=\"#System_Fabric_IStateReplicator_UpdateReplicatorSettings_System_Fabric_ReplicatorSettings_\" data-linktype=\"self-bookmark\">UpdateReplicatorSettings(ReplicatorSettings)</a></div>\r\n          </td>\r\n            <td>\r\n            <p>Enables modification of replicator settings during runtime. The only setting which can be modified is the security credentials. </p>\n\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    <section class=\"memberGroup\">\r\n      <header class=\"header enable-platform-filter\" id=\"methods\">\r\n        <h2>Methods\r\n    </h2>\r\n      </header>\r\n    \r\n      <ul class=\"list-clean enable-platform-filter\">\r\n    \r\n        <li class=\" enable-platform-filter\" id=\"System_Fabric_IStateReplicator_GetCopyStream\">\r\n    \r\n            <a id=\"System_Fabric_IStateReplicator_GetCopyStream_\"></a>\r\n    \r\n            <div class=\"memberEditButton\">\r\n              <a href=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=100\" ms.cmpnm=\"editMember\" data-linktype=\"external\"><i class=\"icon icon-editor\"></i>Edit</a>\r\n            </div>\r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">GetCopyStream()</div>        \r\n            <div class=\"lang-vb\">GetCopyStream()</div>        \r\n          </div>\r\n    \r\n            <p>Gets copy stream.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">IOperationStream GetCopyStream()</code><code class=\"vb lang-vb\">Function GetCopyStream As IOperationStream</code></pre>\r\n    \r\n    \r\n    \r\n              <h4>Returns</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a></div>\r\n                  </div>\r\n                  <p>Returns the copy <a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a>. </p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n              <h4>Exceptions</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a> is a retriable exception. It is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ReconfigurationPending\" data-linktype=\"relative-path\">ReconfigurationPending</a> is returned when the replicator has a pending reconfiguration.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a> is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ObjectClosed\" data-linktype=\"relative-path\">ObjectClosed</a> is returned when the replicator has been closed.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n          \r\n    \r\n            <h4>Remarks</h4>\r\n            <p>The returned CopyStream is an <a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a> that contains <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> objects that implement <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a>. The <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> objects are obtained from the CopyState <a class=\"xref\" href=\"system.fabric.ioperationdatastream\" data-linktype=\"relative-path\">IOperationDataStream</a> that the Primary replica returns from <a class=\"xref\" href=\"system.fabric.istateprovider#System_Fabric_IStateProvider_GetCopyState_System_Int64_System_Fabric_IOperationDataStream_\" data-linktype=\"relative-path\">GetCopyState(Int64, IOperationDataStream)</a>. When a replica is created and has to catch up, it should obtain the CopyStream and begin to send, apply, and acknowledge the Copy objects that implement <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a>. In parallel, the replica responds to the corresponding <a class=\"xref\" href=\"system.fabric.istateprovider#System_Fabric_IStateProvider_GetCopyContext\" data-linktype=\"relative-path\">GetCopyContext()</a> and <a class=\"xref\" href=\"system.fabric.ioperationdatastream#System_Fabric_IOperationDataStream_GetNextAsync_System_Threading_CancellationToken_\" data-linktype=\"relative-path\">GetNextAsync(CancellationToken)</a> calls. The stream is empty when the returned <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a> method is null.</p>\n\r\n    \r\n    \r\n    \r\n        </li>\r\n        <li class=\" enable-platform-filter\" id=\"System_Fabric_IStateReplicator_GetReplicationStream\">\r\n    \r\n            <a id=\"System_Fabric_IStateReplicator_GetReplicationStream_\"></a>\r\n    \r\n            <div class=\"memberEditButton\">\r\n              <a href=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=123\" ms.cmpnm=\"editMember\" data-linktype=\"external\"><i class=\"icon icon-editor\"></i>Edit</a>\r\n            </div>\r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">GetReplicationStream()</div>        \r\n            <div class=\"lang-vb\">GetReplicationStream()</div>        \r\n          </div>\r\n    \r\n            <p>Gets replication stream.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">IOperationStream GetReplicationStream()</code><code class=\"vb lang-vb\">Function GetReplicationStream As IOperationStream</code></pre>\r\n    \r\n    \r\n    \r\n              <h4>Returns</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a></div>\r\n                  </div>\r\n                  <p>Returns the replication <a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a>.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n              <h4>Exceptions</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a> is a retriable exception. It is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ReconfigurationPending\" data-linktype=\"relative-path\">ReconfigurationPending</a> is returned when the replicator has a pending reconfiguration.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a> is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ObjectClosed\" data-linktype=\"relative-path\">ObjectClosed</a> is returned when the replicator has been closed.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n          \r\n    \r\n            <h4>Remarks</h4>\r\n            <p>The ReplicationStream implements <a class=\"xref\" href=\"system.fabric.ioperationstream\" data-linktype=\"relative-path\">IOperationStream</a>. The ReplicationStream contains <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> objects that implement <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a>. The objects are provided by the Primary replica via <a class=\"xref\" href=\"system.fabric.istatereplicator#System_Fabric_IStateReplicator_ReplicateAsync_System_Fabric_OperationData_System_Threading_CancellationToken_System_Int64__\" data-linktype=\"relative-path\">ReplicateAsync(OperationData, CancellationToken, out Int64)</a>. Generally a Secondary replica should send <a class=\"xref\" href=\"system.fabric.ioperationstream#System_Fabric_IOperationStream_GetOperationAsync_System_Threading_CancellationToken_\" data-linktype=\"relative-path\">GetOperationAsync(CancellationToken)</a>. Although Service Fabric does not require services to do so, generally services should transfer all <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> objects out of the copy stream first, and then transfer operations out of the replication stream. The transfer from both copies in parallel is supported but increases the complexity of applying state updates correctly and is recommended only for advanced services. The stream is empty when the returned <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a> method is null.</p>\n\r\n    \r\n    \r\n    \r\n        </li>\r\n        <li class=\" enable-platform-filter\" id=\"System_Fabric_IStateReplicator_ReplicateAsync_System_Fabric_OperationData_System_Threading_CancellationToken_System_Int64__\">\r\n    \r\n            <a id=\"System_Fabric_IStateReplicator_ReplicateAsync_\"></a>\r\n    \r\n            <div class=\"memberEditButton\">\r\n              <a href=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=76\" ms.cmpnm=\"editMember\" data-linktype=\"external\"><i class=\"icon icon-editor\"></i>Edit</a>\r\n            </div>\r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">ReplicateAsync(OperationData, CancellationToken, out Int64)</div>        \r\n            <div class=\"lang-vb\">ReplicateAsync(OperationData, CancellationToken, ByRef Int64)</div>        \r\n          </div>\r\n    \r\n            <p>Replicates state changes from Primary replica to the Secondary replicas and receives a quorum acknowledgement that those state changes have been applied.</p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">Task&lt;long&gt; ReplicateAsync(OperationData operationData, CancellationToken cancellationToken, out long sequenceNumber)</code><code class=\"vb lang-vb\">Function ReplicateAsync(operationData As OperationData, cancellationToken As CancellationToken, ByRef sequenceNumber As Long) As Task(Of Long)</code></pre>\r\n    \r\n    \r\n              <h4>Parameters</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <dl>\r\n                  <dt>operationData</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a></div>\r\n                    <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a></div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> that represents the state change that the Primary replica wants to replicate.</p>\n\r\n                </li>\r\n                <li>\r\n                  <dl>\r\n                  <dt>cancellationToken</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.threading.cancellationtoken(v=vs.110).aspx\" data-linktype=\"external\">CancellationToken</a></div>\r\n                    <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.threading.cancellationtoken(v=vs.110).aspx\" data-linktype=\"external\">CancellationToken</a></div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p> A write quorum of replicas that have been lost. It can be used to send a notification that the operation should be canceled. Note that cancellation is advisory and that the operation might still be completed even if it is canceled.</p>\n\r\n                </li>\r\n                <li>\r\n                  <dl>\r\n                  <dt>sequenceNumber</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.int64(v=vs.110).aspx\" data-linktype=\"external\">Int64</a></div>\r\n                    <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.int64(v=vs.110).aspx\" data-linktype=\"external\">Int64</a></div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>Long, the LSN of the operation. Note that this is the same value which is returned by the task. Providing it as an out parameter is useful for services which want to prepare the local write to commit when the task finishes.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n              <h4>Returns</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/dd321424(v=vs.110).aspx\" data-linktype=\"external\">Task</a>&lt;<a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.int64(v=vs.110).aspx\" data-linktype=\"external\">Int64</a>&gt;</div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/dd321424(v=vs.110).aspx\" data-linktype=\"external\">Task</a>(Of <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.int64(v=vs.110).aspx\" data-linktype=\"external\">Int64</a>)</div>\r\n                  </div>\r\n                  <p>Returns <a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/dd321424(v=vs.110).aspx\" data-linktype=\"external\">Task&lt;TResult&gt;</a> of type long, the LSN of the operation.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n              <h4>Exceptions</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.argumentexception(v=vs.110).aspx\" data-linktype=\"external\">ArgumentException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.argumentexception(v=vs.110).aspx\" data-linktype=\"external\">ArgumentException</a></div>\r\n                  </div>\r\n                  <p>Caused by one of the following:</p>\n<p>E_INVALIDARG is returned when one or more arguments are not valid.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabrictransientexception\" data-linktype=\"relative-path\">FabricTransientException</a> is a retriable exception. It is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_NoWriteQuorum\" data-linktype=\"relative-path\">NoWriteQuorum</a> is returned when the replicator does not currently have write quorum..</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ReconfigurationPending\" data-linktype=\"relative-path\">ReconfigurationPending</a> is returned when the replicator has a pending reconfiguration.</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ReplicationQueueFull\" data-linktype=\"relative-path\">ReplicationQueueFull</a> is returned when the replicator queue is full.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabricnotprimaryexception\" data-linktype=\"relative-path\">FabricNotPrimaryException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabricnotprimaryexception\" data-linktype=\"relative-path\">FabricNotPrimaryException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabricnotprimaryexception\" data-linktype=\"relative-path\">FabricNotPrimaryException</a> is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_NotPrimary\" data-linktype=\"relative-path\">NotPrimary</a> is returned when the replicator has a pending reconfiguration.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"system.fabric.fabricobjectclosedexception\" data-linktype=\"relative-path\">FabricObjectClosedException</a> is caused by one of the following;</p>\n<p>\n<a class=\"xref\" href=\"system.fabric.fabricerrorcode#System_Fabric_FabricErrorCode_ObjectClosed\" data-linktype=\"relative-path\">ObjectClosed</a> is returned when the replicator has been closed.</p>\n\r\n                </li>\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.operationcanceledexception(v=vs.110).aspx\" data-linktype=\"external\">OperationCanceledException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.operationcanceledexception(v=vs.110).aspx\" data-linktype=\"external\">OperationCanceledException</a></div>\r\n                  </div>\r\n                  <p>\n<a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.operationcanceledexception(v=vs.110).aspx\" data-linktype=\"external\">OperationCanceledException</a> is caused by one of the following;</p>\n<p>E_ABORT when replicator cancels an inflight replication operation.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n          \r\n    \r\n            <h4>Remarks</h4>\r\n            <p>Replication at the Primary replica produces the objects that implement <a class=\"xref\" href=\"system.fabric.ioperation\" data-linktype=\"relative-path\">IOperation</a> that the Secondary replica obtains from the Replication Stream via <a class=\"xref\" href=\"system.fabric.istatereplicator#System_Fabric_IStateReplicator_GetReplicationStream\" data-linktype=\"relative-path\">GetReplicationStream()</a>, which is followed by <a class=\"xref\" href=\"system.fabric.ioperationstream#System_Fabric_IOperationStream_GetOperationAsync_System_Threading_CancellationToken_\" data-linktype=\"relative-path\">GetOperationAsync(CancellationToken)</a>. </p>\n<p>The Primary replica has many duties that are related to process state updates. The following steps show the general sequence of events that a Primary replica must handle to replicate and acknowledge a change. </p>\n<p>Part 1: Handling incoming requests: Receive request: Write(x) – Service receives a write request, x. CheckArguments – The service checks the arguments of the request. This check helps ensure the consistency of the service’s state.</p>\n<p>Check current state – The service examines its current state to ensure that the operation is valid and can or should be performed. This check also helps ensure data consistency. It is performed by the service code.</p>\n<p>Acquire Locks – The service should acquire the necessary locks to prevent additional operations from occurring at the same time. This operation helps ensure isolation and consistency.</p>\n<p>Attempt Operation (optional) – The service can attempt the operation locally. This step reserves and allocates space and performs all the necessary computations. This step includes everything but the actual commit of the result. This operation improves the durability of the operation and makes later failures very unlikely.</p>\n<p>Manufacture the OperationData – An <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> object is the representation of the Write(x) that was presented to the service. The <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> object contains the state change to be transferred with acknowledgement from the Primary replica to the Secondary replicas. The data that the service places in the OperationData defines the atomic update that the <a class=\"xref\" href=\"system.fabric.fabricreplicator\" data-linktype=\"relative-path\">FabricReplicator</a> transfers to the Secondary replicas. Note that creating of the <a class=\"xref\" href=\"system.fabric.operationdata\" data-linktype=\"relative-path\">OperationData</a> object requires one or more byte arrays. The service must itself determine and serialize the change in state, and then provide this set of bytes to the FabricReplicator via <a class=\"xref\" href=\"system.fabric.istatereplicator#System_Fabric_IStateReplicator_ReplicateAsync_System_Fabric_OperationData_System_Threading_CancellationToken_System_Int64__\" data-linktype=\"relative-path\">ReplicateAsync(OperationData, CancellationToken, out Int64)</a>. The service sends the operation to the FabricReplicator and receives a logical sequence number (LSN) in return. The LSN is the identity for the operation and helps both the service and Service Fabric ensure that operations are always applied in the same order everywhere.The service should record the OperationData along with its LSN in an ordered list of in-flight operations. This ensures that when the operations are completed, they can be consistently applied in the correct order.</p>\n<p>Release Locks - Continue processing or waiting for further requests.</p>\n<p>Part 2: Completing requests and responding: The Primary replica receives a callback that indicates that the operation has been applied. ReplicateAsync is completed. This callback indicates that the operation has been acknowledged by a quorum of the replicas in the replica set. When the Primary replica receives this callback, it should perform the following actions: </p>\n<p>Find the corresponding operation that is indicated by the long LSN that is returned from ReplicateAsync in the service’s in-flight list and mark it as &quot;QuorumAck’d&quot;. </p>\n<p>Now, starting at the first operation in the in-flight list, go through the list and locally commit all of the QuorumAck’d operations, finish any changes to the local state and mark the state changes with their corresponding LSN, until the first incomplete operation is encountered. This ensures that ordering is preserved (consistency) and that the operations are actually applied. This takes advantage of the previous durability and isolation preparations. Note: Most services should cache the last committed LSN value so that responses to the <a class=\"xref\" href=\"system.fabric.istateprovider#System_Fabric_IStateProvider_GetLastCommittedSequenceNumber\" data-linktype=\"relative-path\">GetLastCommittedSequenceNumber()</a> do not require querying the actual store for the greatest LSN. </p>\n<p>When an operation is successfully committed at the Primary replica, the Primary replica can now reply to the client that initiated the call and remove the operation from the in-flight list. Continue to wait for the next quorum-acknowledgment callback.</p>\n\r\n    \r\n    \r\n    \r\n        </li>\r\n        <li class=\" enable-platform-filter\" id=\"System_Fabric_IStateReplicator_UpdateReplicatorSettings_System_Fabric_ReplicatorSettings_\">\r\n    \r\n            <a id=\"System_Fabric_IStateReplicator_UpdateReplicatorSettings_\"></a>\r\n    \r\n            <div class=\"memberEditButton\">\r\n              <a href=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=135\" ms.cmpnm=\"editMember\" data-linktype=\"external\"><i class=\"icon icon-editor\"></i>Edit</a>\r\n            </div>\r\n    \r\n          <div class=\"memberName\">\r\n            <div class=\"lang-csharp\">UpdateReplicatorSettings(ReplicatorSettings)</div>        \r\n            <div class=\"lang-vb\">UpdateReplicatorSettings(ReplicatorSettings)</div>        \r\n          </div>\r\n    \r\n            <p>Enables modification of replicator settings during runtime. The only setting which can be modified is the security credentials. </p>\n\r\n    \r\n            <pre class=\"memberDeclaration\"><code class=\"csharp lang-csharp\">void UpdateReplicatorSettings(ReplicatorSettings settings)</code><code class=\"vb lang-vb\">Sub UpdateReplicatorSettings(settings As ReplicatorSettings)</code></pre>\r\n    \r\n    \r\n              <h4>Parameters</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <dl>\r\n                  <dt>settings</dt>\r\n                  <dd>\r\n                    <div class=\"lang-csharp\"><a class=\"xref\" href=\"system.fabric.replicatorsettings\" data-linktype=\"relative-path\">ReplicatorSettings</a></div>\r\n                    <div class=\"lang-vb\"><a class=\"xref\" href=\"system.fabric.replicatorsettings\" data-linktype=\"relative-path\">ReplicatorSettings</a></div>\r\n                  </dd>\r\n                  </dl>\r\n                  <p>The new <a class=\"xref\" href=\"system.fabric.replicatorsettings\" data-linktype=\"relative-path\">ReplicatorSettings</a> with the updated credentials.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n    \r\n    \r\n              <h4>Exceptions</h4>\r\n              <ul class=\"memberDetails\">\r\n                <li>\r\n                  <div class=\"single\">                \r\n                      <div class=\"lang-csharp\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.argumentexception(v=vs.110).aspx\" data-linktype=\"external\">ArgumentException</a></div>\r\n                      <div class=\"lang-vb\"><a class=\"xref\" href=\"https://msdn.microsoft.com/en-us/library/system.argumentexception(v=vs.110).aspx\" data-linktype=\"external\">ArgumentException</a></div>\r\n                  </div>\r\n                  <p>Caused by one of the following:</p>\n<p>E_INVALIDARG is returned when one or more arguments are not valid.</p>\n\r\n                </li>\r\n              </ul>\r\n    \r\n          \r\n    \r\n    \r\n    \r\n    \r\n        </li>\r\n      </ul>\r\n    </section>\r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n    \r\n      <h2>Details</h2>\r\n        <div class=\"lang-csharp lang-vb enable-lang-filter detailTile\">\r\n          <h4>Namespace</h4>    \r\n          <div>System.Fabric</div>\r\n        </div>\r\n        <div class=\"lang-csharp lang-vb enable-lang-filter detailTile\">\r\n          <h4>Assembly</h4>    \r\n          <div>System.Fabric.dll</div>\r\n        </div>\r\n    \r\n    \r\n","outputRootRelativePath":"./","pageMetadata":"<meta name=\"ms.devlang\" content=\"csharp\">\r\n<meta name=\"author\" content=\"erickson-doug\">\r\n<meta name=\"ms.author\" content=\"douge\">\r\n<meta name=\"manager\" content=\"douge\">\r\n<meta name=\"breadcrumb_path\" content=\"breadcrumb/toc.json\">\r\n<meta name=\"ms.topic\" content=\"reference\">\r\n<meta name=\"ms.service\" content=\"service-fabric\">\r\n<meta name=\"ms.date\" content=\"11/16/2016\">\r\n<meta name=\"search.ms_sitename\" content=\"Docs\">\r\n<meta name=\"search.ms_docsetname\" content=\"azuredotnet\">\r\n<meta name=\"version\" content=\"0\">\r\n<meta name=\"locale\" content=\"en-us\">\r\n<meta name=\"site_name\" content=\"Docs\">\r\n<meta name=\"search.ms_product\" content=\"Azure\">\r\n<meta name=\"depot_name\" content=\"Azure.azuredotnet\">\r\n<meta name=\"ref_skeleton_gitcommit\" content=\"https://github.com/Azure/azure-docs-sdk-dotnet/blob/8ece26063f2f27414f0bad873159ee6212f3448d/docs-ref-manual/Data/ServiceFabric/System.Fabric.IStateReplicator.yml\">\r\n<meta name=\"original_ref_skeleton_git_url\" content=\"https://github.com/Azure/azure-docs-sdk-dotnet/blob/live/docs-ref-manual/Data/ServiceFabric/System.Fabric.IStateReplicator.yml\">\r\n<meta name=\"APIName\" content=\"System.Fabric.IStateReplicator\">\r\n<meta name=\"APIName\" content=\"System.Fabric.IStateReplicator.ReplicateAsync\">\r\n<meta name=\"APIName\" content=\"System.Fabric.IStateReplicator.GetCopyStream\">\r\n<meta name=\"APIName\" content=\"System.Fabric.IStateReplicator.GetReplicationStream\">\r\n<meta name=\"APIName\" content=\"System.Fabric.IStateReplicator.UpdateReplicatorSettings\">\r\n<meta name=\"APILocation\" content=\"System.Fabric.dll\">\r\n<meta name=\"TopicType\" content=\"apiref\">\r\n<meta name=\"APIType\" content=\"Assembly\">\r\n<meta name=\"updated_at\" content=\"2016-12-26 05:25 AM\">\r\n<meta name=\"document_id\" content=\"5f280c99-bbf8-5659-abfe-34a579886346\">\r\n<meta name=\"pagetype\" content=\"Reference\">\r\n<meta name=\"description\" content=\"Exposes replication-related functions of the  class that are used by  to replicate state to ensure high availability. \n\">\r\n<meta name=\"toc_rel\" content=\"toc.json\">\r\n<meta name=\"source_url\" content=\"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&amp;version=GBdevelop&amp;line=15\">\r\n<meta name=\"ms.assetid\" content=\"System.Fabric.IStateReplicator\">\r\n","rawMetadata":{"ms.devlang":"csharp","author":"erickson-doug","ms.author":"douge","manager":"douge","breadcrumb_path":"breadcrumb/toc.json","_op_documentIdPathDepotMapping":{"./":{"folder_relative_path_in_docset":"api-index"},"breadcrumb/":{"folder_relative_path_in_docset":"breadcrumb"},"docs-ref-autogen/":{"folder_relative_path_in_docset":"docs-ref-autogen"},"docs-ref-manual/":{"folder_relative_path_in_docset":"docs-ref-manual"},"docs-ref-overwrite/":{"folder_relative_path_in_docset":"docs-ref-overwrite"},"scripts/":{"folder_relative_path_in_docset":"scripts"}},"ms.topic":"reference","ms.service":"service-fabric","ms.date":"11/16/2016","search.ms_sitename":"Docs","search.ms_docsetname":"azuredotnet","version":0,"_op_canonicalUrlPrefix":"https://docs.microsoft.com/en-us/dotnet/api/","locale":"en-us","site_name":"Docs","search.ms_product":"Azure","_op_openToPublicContributors":false,"depot_name":"Azure.azuredotnet","_op_gitRefSkeletonCommitHistory":[{"author_name":"Qinen Zhu","author_email":"qinzhu@microsoft.com","committer_name":"Qinen Zhu","comitter_email":"qinzhu@microsoft.com","message":"Rename folder name","commit_sha":"8ece26063f2f27414f0bad873159ee6212f3448d","commit_date":"2016-12-19 15:23:17 +0800"}],"ref_skeleton_gitcommit":"https://github.com/Azure/azure-docs-sdk-dotnet/blob/8ece26063f2f27414f0bad873159ee6212f3448d/docs-ref-manual/Data/ServiceFabric/System.Fabric.IStateReplicator.yml","original_ref_skeleton_git_url":"https://github.com/Azure/azure-docs-sdk-dotnet/blob/live/docs-ref-manual/Data/ServiceFabric/System.Fabric.IStateReplicator.yml","open_to_public_contributors":false,"api_name":["System.Fabric.IStateReplicator","System.Fabric.IStateReplicator.ReplicateAsync","System.Fabric.IStateReplicator.GetCopyStream","System.Fabric.IStateReplicator.GetReplicationStream","System.Fabric.IStateReplicator.UpdateReplicatorSettings"],"api_location":["System.Fabric.dll"],"topic_type":["apiref"],"api_type":["Assembly"],"f1_keywords":["System.Fabric.IStateReplicator","System::Fabric::IStateReplicator","System.Fabric.IStateReplicator.ReplicateAsync","System::Fabric::IStateReplicator::ReplicateAsync","System.Fabric.IStateReplicator.GetCopyStream","System::Fabric::IStateReplicator::GetCopyStream","System.Fabric.IStateReplicator.GetReplicationStream","System::Fabric::IStateReplicator::GetReplicationStream","System.Fabric.IStateReplicator.UpdateReplicatorSettings","System::Fabric::IStateReplicator::UpdateReplicatorSettings"],"dev_langs":["csharp","vb"],"updated_at":"2016-12-26 05:25 AM","document_id":"5f280c99-bbf8-5659-abfe-34a579886346","layout":"Reference","_op_layout":"Reference","pagetype":"Reference","title":"IStateReplicator interface | Microsoft Docs","_op_ogTitle":"IStateReplicator interface","description":"Exposes replication-related functions of the  class that are used by  to replicate state to ensure high availability. \n","toc_asset_id":"toc.json","toc_rel":"toc.json","content_git_url":"","source_url":"https://msazure.visualstudio.com/DefaultCollection/One/_git/WindowsFabric?path=src/prod/src/managed/Api/src/System/Fabric/IStateReplicator.cs&version=GBdevelop&line=15","ms.assetid":"System.Fabric.IStateReplicator","canonical_url":"https://docs.microsoft.com/en-us/dotnet-all/system.fabric.istatereplicator","_op_displayDate":"2016-11-16","_op_displayDate_source":"2016-11-16T00:00:00Z","_op_brand":"azure","_op_canonicalUrl":"https://docs.microsoft.com/en-us/dotnet-all/system.fabric.istatereplicator","fileRelativePath":"System.Fabric.IStateReplicator.html"},"themesRelativePathToOutputRoot":"_themes/"}